<!DOCTYPE html>
<!-- Generated by Cython 0.29.37 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: _protocol.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #3D7B7B; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #9C6500 } /* Comment.Preproc */
.cython .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cython .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.cython .gr { color: #E40000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #008400 } /* Generic.Inserted */
.cython .go { color: #717171 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #687822 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #717171; font-weight: bold } /* Name.Entity */
.cython .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #767600 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #A45A77 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.37</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="_protocol.c">_protocol.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="c">#</span></pre>
<pre class='cython code score-8 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: <span class="c"># Copyright 2016 Quantopian, Inc.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: <span class="c"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: <span class="c"># you may not use this file except in compliance with the License.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: <span class="c"># You may obtain a copy of the License at</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="c">#     http://www.apache.org/licenses/LICENSE-2.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: <span class="c"># Unless required by applicable law or agreed to in writing, software</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: <span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: <span class="c"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="c"># See the License for the specific language governing permissions and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: <span class="c"># limitations under the License.</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">015</span>: <span class="k">import</span> <span class="nn">warnings</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_warnings, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_warnings, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">016</span>: <span class="k">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_contextmanager);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_contextmanager);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_contextmanager);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_contextlib, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_contextmanager);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_contextmanager, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">017</span>: <span class="k">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_wraps);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_wraps);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_wraps);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_functools, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_wraps);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_wraps, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">018</span>: <span class="k">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_pandas, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_pd, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">019</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">020</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: <span class="k">from</span> <span class="nn">cpython</span> <span class="k">cimport</span> <span class="nb">bool</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">022</span>: <span class="k">from</span> <span class="nn">collections.abc</span> <span class="k">import</span> <span class="n">Iterable</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_Iterable);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_Iterable);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_Iterable);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_collections_abc, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_Iterable);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_Iterable, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">023</span>: </pre>
<pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">024</span>: <span class="k">from</span> <span class="nn">zipline.assets</span> <span class="k">import</span> <span class="p">(</span></pre>
<pre class='cython code score-12 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_zipline_assets, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_PricingDataAssociable);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_PricingDataAssociable, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">025</span>:     <span class="n">PricingDataAssociable</span><span class="p">,</span></pre>
<pre class='cython code score-7 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_PricingDataAssociable);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_PricingDataAssociable);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_PricingDataAssociable);
</pre><pre class="cython line score-0">&#xA0;<span class="">026</span>: <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: <span class="k">from</span> <span class="nn">zipline.assets._assets</span> <span class="k">cimport</span> <span class="n">Asset</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">028</span>: <span class="k">from</span> <span class="nn">zipline.assets.continuous_futures</span> <span class="k">import</span> <span class="n">ContinuousFuture</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_ContinuousFuture);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_ContinuousFuture);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_ContinuousFuture);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_zipline_assets_continuous_future, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_ContinuousFuture);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ContinuousFuture, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">029</span>: <span class="k">from</span> <span class="nn">zipline.utils.pandas_utils</span> <span class="k">import</span> <span class="n">normalize_date</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_normalize_date);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_normalize_date);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_normalize_date);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_zipline_utils_pandas_utils, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_normalize_date);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_normalize_date, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 29, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">030</span>: <span class="k">from</span> <span class="nn">zipline.zipline_warnings</span> <span class="k">import</span> <span class="n">ZiplineDeprecationWarning</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_ZiplineDeprecationWarning);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_ZiplineDeprecationWarning);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_ZiplineDeprecationWarning);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_zipline_zipline_warnings, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_ZiplineDeprecationWarning);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ZiplineDeprecationWarning, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">031</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">032</span>: <span class="k">cdef</span> <span class="kt">bool</span> <span class="nf">_is_iterable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span></pre>
<pre class='cython code score-4 '>static PyBoolObject *__pyx_f_7zipline_9_protocol__is_iterable(PyObject *__pyx_v_obj) {
  PyBoolObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_is_iterable", 0);
  <span class='trace'>__Pyx_TraceCall</span>("_is_iterable", __pyx_f[0], 32, 0, <span class='error_goto'>__PYX_ERR(0, 32, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol._is_iterable", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">033</span>:     <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></pre>
<pre class='cython code score-22 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_Iterable);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_obj, __pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {
  } else {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_7cpython_4bool_bool)))) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L1_error)</span>
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_3 = <span class='py_c_api'>PyUnicode_Check</span>(__pyx_v_obj); 
  __pyx_t_4 = (!(__pyx_t_3 != 0));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_7cpython_4bool_bool)))) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L1_error)</span>
  __pyx_t_1 = __pyx_t_2;
  __pyx_t_2 = 0;
  __pyx_L3_bool_binop_done:;
  __pyx_r = ((PyBoolObject *)__pyx_t_1);
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">034</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">035</span>: <span class="k">cdef</span> <span class="k">class</span> <span class="nf">check_parameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>struct __pyx_obj_7zipline_9_protocol_check_parameters {
  PyObject_HEAD
  PyObject *keyword_names;
  PyObject *types;
  PyObject *keys_to_types;
};

</pre><pre class="cython line score-0">&#xA0;<span class="">036</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="sd">    Asserts that the keywords passed into the wrapped function are included</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: <span class="sd">    in those passed into this decorator. If not, raise a TypeError with a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: <span class="sd">    meaningful message, unlike the one Cython returns by default.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: <span class="sd">    Also asserts that the arguments passed into the wrapped function are</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: <span class="sd">    consistent with the types passed into this decorator. If not, raise a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: <span class="sd">    TypeError with a meaningful message.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>:     <span class="k">cdef</span> <span class="kt">tuple</span> <span class="nf">keyword_names</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>:     <span class="k">cdef</span> <span class="kt">tuple</span> <span class="nf">types</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>:     <span class="k">cdef</span> <span class="kt">dict</span> <span class="nf">keys_to_types</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: </pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>:     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword_names</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span></pre>
<pre class='cython code score-28 '>/* Python wrapper */
static int __pyx_pw_7zipline_9_protocol_16check_parameters_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7zipline_9_protocol_16check_parameters_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_keyword_names = 0;
  PyObject *__pyx_v_types = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_keyword_names,&amp;__pyx_n_s_types,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_keyword_names)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_types)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_keyword_names = values[0];
    __pyx_v_types = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.check_parameters.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7zipline_9_protocol_16check_parameters___init__(((struct __pyx_obj_7zipline_9_protocol_check_parameters *)__pyx_v_self), __pyx_v_keyword_names, __pyx_v_types);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_7zipline_9_protocol_16check_parameters___init__(struct __pyx_obj_7zipline_9_protocol_check_parameters *__pyx_v_self, PyObject *__pyx_v_keyword_names, PyObject *__pyx_v_types) {
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 49, 0, <span class='error_goto'>__PYX_ERR(0, 49, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.check_parameters.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">050</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">keyword_names</span> <span class="o">=</span> <span class="n">keyword_names</span></pre>
<pre class='cython code score-12 '>  if (!(likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_keyword_names))||((__pyx_v_keyword_names) == Py_None)||((void)<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v_keyword_names)-&gt;tp_name), 0))) <span class='error_goto'>__PYX_ERR(0, 50, __pyx_L1_error)</span>
  __pyx_t_1 = __pyx_v_keyword_names;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;keyword_names);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;keyword_names);
  __pyx_v_self-&gt;keyword_names = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">051</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="o">=</span> <span class="n">types</span></pre>
<pre class='cython code score-12 '>  if (!(likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_types))||((__pyx_v_types) == Py_None)||((void)<span class='py_c_api'>PyErr_Format</span>(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v_types)-&gt;tp_name), 0))) <span class='error_goto'>__PYX_ERR(0, 51, __pyx_L1_error)</span>
  __pyx_t_1 = __pyx_v_types;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;types);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;types);
  __pyx_v_self-&gt;types = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">052</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">053</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">keys_to_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keyword_names</span><span class="p">,</span> <span class="n">types</span><span class="p">))</span></pre>
<pre class='cython code score-16 '>  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 53, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_keyword_names);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_keyword_names);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_keyword_names);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_types);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_types);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_types);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_zip, __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 53, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(((PyObject *)(&amp;PyDict_Type)), __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 53, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;keys_to_types);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;keys_to_types);
  __pyx_v_self-&gt;keys_to_types = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">054</span>: </pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">055</span>:     <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span></pre>
<pre class='cython code score-29 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_16check_parameters_3__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_7zipline_9_protocol_16check_parameters_3__call__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_func = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__call__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_func,0};
    PyObject* values[1] = {0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_func)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__call__") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 1) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
    }
    __pyx_v_func = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__call__", 1, 1, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.check_parameters.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7zipline_9_protocol_16check_parameters_2__call__(((struct __pyx_obj_7zipline_9_protocol_check_parameters *)__pyx_v_self), __pyx_v_func);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
static PyObject *__pyx_pf_7zipline_9_protocol_16check_parameters_2__call__(struct __pyx_obj_7zipline_9_protocol_check_parameters *__pyx_v_self, PyObject *__pyx_v_func) {
  struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct____call__ *__pyx_cur_scope;
  PyObject *__pyx_v_assert_keywords_and_call = 0;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__call__", 0);
  __pyx_cur_scope = (struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct____call__ *)__pyx_tp_new_7zipline_9_protocol___pyx_scope_struct____call__(__pyx_ptype_7zipline_9_protocol___pyx_scope_struct____call__, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct____call__ *)Py_None);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L1_error)</span>
  } else {
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_cur_scope);
  }
  <span class='trace'>__Pyx_TraceCall</span>("__call__", __pyx_f[0], 55, 0, <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L1_error)</span>);
  __pyx_cur_scope-&gt;__pyx_v_self = __pyx_v_self;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_cur_scope-&gt;__pyx_v_self);
  <span class='refnanny'>__Pyx_GIVEREF</span>((PyObject *)__pyx_cur_scope-&gt;__pyx_v_self);
  __pyx_cur_scope-&gt;__pyx_v_func = __pyx_v_func;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_cur_scope-&gt;__pyx_v_func);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_cur_scope-&gt;__pyx_v_func);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.check_parameters.__call__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_assert_keywords_and_call);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_cur_scope));
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct____call__ {
  PyObject_HEAD
  PyObject *__pyx_v_func;
  struct __pyx_obj_7zipline_9_protocol_check_parameters *__pyx_v_self;
};

</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>:         <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></pre>
<pre class='cython code score-16 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_wraps);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 56, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_cur_scope-&gt;__pyx_v_func) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_cur_scope-&gt;__pyx_v_func);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 56, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-55" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">057</span>:         <span class="k">def</span> <span class="nf">assert_keywords_and_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre>
<pre class='cython code score-55 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_16check_parameters_8__call___1assert_keywords_and_call(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_7zipline_9_protocol_16check_parameters_8__call___1assert_keywords_and_call = {"assert_keywords_and_call", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_7zipline_9_protocol_16check_parameters_8__call___1assert_keywords_and_call, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_7zipline_9_protocol_16check_parameters_8__call___1assert_keywords_and_call(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kwargs = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("assert_keywords_and_call (wrapper)", 0);
  if (unlikely(__pyx_kwds) &amp;&amp; unlikely(!<span class='pyx_c_api'>__Pyx_CheckKeywordStrings</span>(__pyx_kwds, "assert_keywords_and_call", 1))) return NULL;
  __pyx_v_kwargs = (__pyx_kwds) ? <span class='py_c_api'>PyDict_Copy</span>(__pyx_kwds) : <span class='py_c_api'>PyDict_New</span>(); if (unlikely(!__pyx_v_kwargs)) return NULL;
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_kwargs);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_args);
  __pyx_v_args = __pyx_args;
  __pyx_r = __pyx_pf_7zipline_9_protocol_16check_parameters_8__call___assert_keywords_and_call(__pyx_self, __pyx_v_args, __pyx_v_kwargs);

  /* function exit code */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_args);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_kwargs);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_16check_parameters_8__call___assert_keywords_and_call(PyObject *__pyx_self, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs) {
  struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct____call__ *__pyx_cur_scope;
  struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct____call__ *__pyx_outer_scope;
  short __pyx_v_i;
  PyObject *__pyx_v_field = NULL;
  PyObject *__pyx_v_arg = NULL;
  PyObject *__pyx_v_expected_type = NULL;
  PyObject *__pyx_v_expected_type_name = NULL;
  PyObject *__pyx_v_keyword = NULL;
  PyObject *__pyx_7genexpr__pyx_v_type_ = NULL;
  PyObject *__pyx_8genexpr1__pyx_v_type_ = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("assert_keywords_and_call", 0);
  __pyx_outer_scope = (struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct____call__ *) <span class='pyx_c_api'>__Pyx_CyFunction_GetClosure</span>(__pyx_self);
  __pyx_cur_scope = __pyx_outer_scope;
  <span class='trace'>__Pyx_TraceCall</span>("assert_keywords_and_call", __pyx_f[0], 57, 0, <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.check_parameters.__call__.assert_keywords_and_call", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_field);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_arg);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_expected_type);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_expected_type_name);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_keyword);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_7genexpr__pyx_v_type_);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr1__pyx_v_type_);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(10, __pyx_n_s_args, __pyx_n_s_kwargs, __pyx_n_s_i, __pyx_n_s_field, __pyx_n_s_arg, __pyx_n_s_expected_type, __pyx_n_s_expected_type_name, __pyx_n_s_keyword, __pyx_n_s_type, __pyx_n_s_type);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);
/* … */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_7zipline_9_protocol_16check_parameters_8__call___1assert_keywords_and_call, 0, __pyx_n_s_call___locals_assert_keywords, ((PyObject*)__pyx_cur_scope), __pyx_n_s_zipline__protocol, __pyx_d, ((PyObject *)__pyx_codeobj__5));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 56, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_assert_keywords_and_call = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_codeobj__5 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(0, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__4, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_zipline__protocol_pyx, __pyx_n_s_assert_keywords_and_call, 57, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">058</span>:             <span class="k">cdef</span> <span class="kt">short</span> <span class="nf">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>:             <span class="c"># verify all the keyword arguments</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">061</span>:             <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_dict_iterator(__pyx_v_kwargs, 1, ((PyObject *)NULL), (&amp;__pyx_t_3), (&amp;__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 61, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  __pyx_t_1 = __pyx_t_5;
  __pyx_t_5 = 0;
  while (1) {
    __pyx_t_6 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_3, &amp;__pyx_t_2, &amp;__pyx_t_5, NULL, NULL, __pyx_t_4);
    if (unlikely(__pyx_t_6 == 0)) break;
    if (unlikely(__pyx_t_6 == -1)) <span class='error_goto'>__PYX_ERR(0, 61, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_field, __pyx_t_5);
    __pyx_t_5 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">062</span>:                 <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyword_names</span><span class="p">:</span></pre>
<pre class='cython code score-5 '>    if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_self)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("self"); <span class='error_goto'>__PYX_ERR(0, 62, __pyx_L1_error)</span> }
    __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PySequence_ContainsTF</span>(__pyx_v_field, __pyx_cur_scope-&gt;__pyx_v_self-&gt;keyword_names, Py_NE)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 62, __pyx_L1_error)</span>
    __pyx_t_8 = (__pyx_t_7 != 0);
    if (unlikely(__pyx_t_8)) {
/* … */
    }
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">063</span>:                     <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">() got an unexpected keyword argument&quot;</span></pre>
<pre class='cython code score-14 '>      __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 63, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_9 = 0;
      __pyx_t_10 = 127;
/* … */
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyUnicode_Join</span>(__pyx_t_5, 4, __pyx_t_9, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 63, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_TypeError, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 63, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='error_goto'>__PYX_ERR(0, 63, __pyx_L1_error)</span>
</pre><pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">064</span>:                                     <span class="s">&quot; &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">field</span><span class="p">))</span></pre>
<pre class='cython code score-37 '>      if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_func)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("func"); <span class='error_goto'>__PYX_ERR(0, 64, __pyx_L1_error)</span> }
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_cur_scope-&gt;__pyx_v_func, __pyx_n_s_name);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 64, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Unicode</span>(__pyx_t_11), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 64, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_12) &gt; __pyx_t_10) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_12) : __pyx_t_10;
      __pyx_t_9 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_12);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_12);
      __pyx_t_12 = 0;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_got_an_unexpected_keyword_argum);
      __pyx_t_9 += 39;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_got_an_unexpected_keyword_argum);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_kp_u_got_an_unexpected_keyword_argum);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Unicode</span>(__pyx_v_field), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 64, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_12) &gt; __pyx_t_10) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_12) : __pyx_t_10;
      __pyx_t_9 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_12);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_12);
      __pyx_t_12 = 0;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_);
      __pyx_t_9 += 1;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 3, __pyx_kp_u_);
</pre><pre class="cython line score-0">&#xA0;<span class="">065</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:             <span class="c"># verify type of each argument</span></pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">067</span>:             <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mf">1</span><span class="p">:]):</span></pre>
<pre class='cython code score-10 '>  __pyx_t_13 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyTuple_GetSlice</span>(__pyx_v_args, 1, PY_SSIZE_T_MAX);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 67, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (__pyx_t_3 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_3++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 67, __pyx_L1_error)</span>
    #else
    __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 67, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    #endif
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_arg, __pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_v_i = __pyx_t_13;
    __pyx_t_13 = (__pyx_t_13 + 1);
/* … */
    __pyx_L6_continue:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">068</span>:                 <span class="n">expected_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-10 '>    if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_self)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("self"); <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L1_error)</span> }
    if (unlikely(__pyx_cur_scope-&gt;__pyx_v_self-&gt;types == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L1_error)</span>
    }
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt_Tuple</span>(__pyx_cur_scope-&gt;__pyx_v_self-&gt;types, __pyx_v_i, short, 1, __Pyx_PyInt_From_short, 0, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_expected_type, __pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">069</span>: </pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">070</span>:                 <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mf">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_iterable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span></pre>
<pre class='cython code score-3 '>    switch (__pyx_v_i) {
      case 0:
      case 1:
      __pyx_t_7 = 1;
      break;
      default:
      __pyx_t_7 = 0;
      break;
    }
    if (__pyx_t_7) {
    } else {
      __pyx_t_8 = __pyx_t_7;
      goto __pyx_L9_bool_binop_done;
    }
    __pyx_t_1 = ((PyObject *)__pyx_f_7zipline_9_protocol__is_iterable(__pyx_v_arg));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 70, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_8 = __pyx_t_7;
    __pyx_L9_bool_binop_done:;
    if (__pyx_t_8) {
/* … */
    }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">071</span>:                     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-5 '>      __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_arg);<span class='error_goto'> if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 71, __pyx_L1_error)</span>
      __pyx_t_8 = ((__pyx_t_2 == 0) != 0);
      if (__pyx_t_8) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">072</span>:                         <span class="k">continue</span></pre>
<pre class='cython code score-0 '>        goto __pyx_L6_continue;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">073</span>:                     <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-3 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_arg, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_arg, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">074</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">075</span>:                 <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">expected_type</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>    __pyx_t_8 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_arg, __pyx_v_expected_type);<span class='error_goto'> if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 75, __pyx_L1_error)</span>
    __pyx_t_7 = ((!(__pyx_t_8 != 0)) != 0);
    if (unlikely(__pyx_t_7)) {
/* … */
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">076</span>:                     <span class="n">expected_type_name</span> <span class="o">=</span> <span class="n">expected_type</span><span class="o">.</span><span class="n">__name__</span> <span class="w">\</span></pre>
<pre class='cython code score-2 '>        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_expected_type, __pyx_n_s_name);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 76, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        __pyx_t_1 = __pyx_t_12;
        __pyx_t_12 = 0;
      } else {
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">077</span>:                         <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_iterable</span><span class="p">(</span><span class="n">expected_type</span><span class="p">)</span> <span class="w">\</span></pre>
<pre class='cython code score-3 '>      __pyx_t_12 = ((PyObject *)__pyx_f_7zipline_9_protocol__is_iterable(__pyx_v_expected_type));<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 77, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_12); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 77, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      if (((!__pyx_t_7) != 0)) {
</pre><pre class="cython line score-61" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">078</span>:                         <span class="k">else</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">type_</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span> <span class="n">expected_type</span><span class="p">])</span></pre>
<pre class='cython code score-61 '>        { /* enter inner scope */
          __pyx_t_12 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 78, __pyx_L15_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_expected_type)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_expected_type)) {
            __pyx_t_11 = __pyx_v_expected_type; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11); __pyx_t_2 = 0;
            __pyx_t_14 = NULL;
          } else {
            __pyx_t_2 = -1; __pyx_t_11 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_expected_type);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 78, __pyx_L15_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
            __pyx_t_14 = Py_TYPE(__pyx_t_11)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 78, __pyx_L15_error)</span>
          }
          for (;;) {
            if (likely(!__pyx_t_14)) {
              if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_11))) {
                if (__pyx_t_2 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_11)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_15 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_11, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15); __pyx_t_2++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 78, __pyx_L15_error)</span>
                #else
                __pyx_t_15 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_11, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 78, __pyx_L15_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
                #endif
              } else {
                if (__pyx_t_2 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_11)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_15 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_11, __pyx_t_2); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15); __pyx_t_2++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 78, __pyx_L15_error)</span>
                #else
                __pyx_t_15 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_11, __pyx_t_2); __pyx_t_2++;<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 78, __pyx_L15_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
                #endif
              }
            } else {
              __pyx_t_15 = __pyx_t_14(__pyx_t_11);
              if (unlikely(!__pyx_t_15)) {
                PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                if (exc_type) {
                  if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                  else <span class='error_goto'>__PYX_ERR(0, 78, __pyx_L15_error)</span>
                }
                break;
              }
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
            }
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_7genexpr__pyx_v_type_, __pyx_t_15);
            __pyx_t_15 = 0;
            __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_7genexpr__pyx_v_type_, __pyx_n_s_name);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 78, __pyx_L15_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
            if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_12, (PyObject*)__pyx_t_15))) <span class='error_goto'>__PYX_ERR(0, 78, __pyx_L15_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_7genexpr__pyx_v_type_); __pyx_7genexpr__pyx_v_type_ = 0;
          goto __pyx_L18_exit_scope;
          __pyx_L15_error:;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_7genexpr__pyx_v_type_); __pyx_7genexpr__pyx_v_type_ = 0;
          goto __pyx_L1_error;
          __pyx_L18_exit_scope:;
        } /* exit inner scope */
        __pyx_t_11 = <span class='py_c_api'>PyUnicode_Join</span>(__pyx_kp_u__2, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 78, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_1 = __pyx_t_11;
        __pyx_t_11 = 0;
      }
      __pyx_v_expected_type_name = __pyx_t_1;
      __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">079</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>:                     <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Expected </span><span class="si">%s</span><span class="s"> argument to be of type </span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span></pre>
<pre class='cython code score-16 '>      __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_2 = 0;
      __pyx_t_10 = 127;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_Expected);
      __pyx_t_2 += 9;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_Expected);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_kp_u_Expected);
/* … */
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyUnicode_Join</span>(__pyx_t_1, 5, __pyx_t_2, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 80, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_TypeError, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='error_goto'>__PYX_ERR(0, 80, __pyx_L1_error)</span>
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">081</span>:                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyword_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span></pre>
<pre class='cython code score-26 '>      if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_self)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("self"); <span class='error_goto'>__PYX_ERR(0, 81, __pyx_L1_error)</span> }
      if (unlikely(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keyword_names == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
        <span class='error_goto'>__PYX_ERR(0, 81, __pyx_L1_error)</span>
      }
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetItemInt_Tuple</span>(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keyword_names, __pyx_v_i, short, 1, __Pyx_PyInt_From_short, 0, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 81, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Unicode</span>(__pyx_t_11), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 81, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_12) &gt; __pyx_t_10) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_12) : __pyx_t_10;
      __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_12);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_12);
      __pyx_t_12 = 0;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_argument_to_be_of_type);
      __pyx_t_2 += 24;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_argument_to_be_of_type);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_kp_u_argument_to_be_of_type);
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">082</span>:                                      <span class="s">&#39;or iterable of type &#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span></pre>
<pre class='cython code score-12 '>      switch (__pyx_v_i) {
        case 0:
        case 1:
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_or_iterable_of_type);
        __pyx_t_12 = __pyx_kp_u_or_iterable_of_type;
        break;
        default:
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u__3);
        __pyx_t_12 = __pyx_kp_u__3;
        break;
      }
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyUnicode_Unicode</span>(__pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 82, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_11) &gt; __pyx_t_10) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_11) : __pyx_t_10;
      __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_11);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, __pyx_t_11);
      __pyx_t_11 = 0;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">083</span>:                                      <span class="n">expected_type_name</span><span class="p">)</span></pre>
<pre class='cython code score-14 '>      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Unicode</span>(__pyx_v_expected_type_name), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_11) &gt; __pyx_t_10) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_11) : __pyx_t_10;
      __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_11);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, __pyx_t_11);
      __pyx_t_11 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">084</span>:                                     <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>:             <span class="c"># verify type of each kwarg</span></pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">087</span>:             <span class="k">for</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></pre>
<pre class='cython code score-3 '>  __pyx_t_3 = 0;
  __pyx_t_1 = __Pyx_dict_iterator(__pyx_v_kwargs, 1, __pyx_n_s_items, (&amp;__pyx_t_2), (&amp;__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 87, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __pyx_t_5 = __pyx_t_1;
  __pyx_t_1 = 0;
  while (1) {
    __pyx_t_6 = __Pyx_dict_iter_next(__pyx_t_5, __pyx_t_2, &amp;__pyx_t_3, &amp;__pyx_t_1, &amp;__pyx_t_11, NULL, __pyx_t_4);
    if (unlikely(__pyx_t_6 == 0)) break;
    if (unlikely(__pyx_t_6 == -1)) <span class='error_goto'>__PYX_ERR(0, 87, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_keyword, __pyx_t_1);
    __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_arg, __pyx_t_11);
    __pyx_t_11 = 0;
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:                 <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;assets&#39;</span><span class="p">,</span> <span class="s">&#39;fields&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_iterable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span></pre>
<pre class='cython code score-9 '>    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_keyword);
    __pyx_t_11 = __pyx_v_keyword;
    __pyx_t_16 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_11, __pyx_n_u_assets, Py_EQ)); if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 88, __pyx_L1_error)</span>
    if (!__pyx_t_16) {
    } else {
      __pyx_t_8 = __pyx_t_16;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_16 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_11, __pyx_n_u_fields, Py_EQ)); if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 88, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_t_16;
    __pyx_L24_bool_binop_done:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_16 = (__pyx_t_8 != 0);
    if (__pyx_t_16) {
    } else {
      __pyx_t_7 = __pyx_t_16;
      goto __pyx_L22_bool_binop_done;
    }
    __pyx_t_11 = ((PyObject *)__pyx_f_7zipline_9_protocol__is_iterable(__pyx_v_arg));<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 88, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_11); if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 88, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_7 = __pyx_t_16;
    __pyx_L22_bool_binop_done:;
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:                     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-5 '>      __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_arg);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 89, __pyx_L1_error)</span>
      __pyx_t_7 = ((__pyx_t_9 == 0) != 0);
      if (__pyx_t_7) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">090</span>:                         <span class="k">continue</span></pre>
<pre class='cython code score-0 '>        goto __pyx_L19_continue;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:                     <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-3 '>      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_arg, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 91, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_arg, __pyx_t_11);
      __pyx_t_11 = 0;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>:                 <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys_to_types</span><span class="p">[</span><span class="n">keyword</span><span class="p">]):</span></pre>
<pre class='cython code score-16 '>    if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_self)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("self"); <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span> }
    if (unlikely(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keys_to_types == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
    }
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keys_to_types, __pyx_v_keyword);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_7 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_arg, __pyx_t_11);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 92, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_16 = ((!(__pyx_t_7 != 0)) != 0);
    if (unlikely(__pyx_t_16)) {
/* … */
    }
    __pyx_L19_continue:;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>:                     <span class="n">expected_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys_to_types</span><span class="p">[</span><span class="n">keyword</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span> <span class="w">\</span></pre>
<pre class='cython code score-12 '>        if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_self)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("self"); <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span> }
        if (unlikely(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keys_to_types == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 93, __pyx_L1_error)</span>
        }
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keys_to_types, __pyx_v_keyword);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_name);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_11 = __pyx_t_1;
        __pyx_t_1 = 0;
      } else {
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:                         <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys_to_types</span><span class="p">[</span><span class="n">keyword</span><span class="p">])</span> <span class="w">\</span></pre>
<pre class='cython code score-13 '>      if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_self)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("self"); <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span> }
      if (unlikely(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keys_to_types == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
        <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span>
      }
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keys_to_types, __pyx_v_keyword);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_12 = ((PyObject *)__pyx_f_7zipline_9_protocol__is_iterable(__pyx_t_1));<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_12); if (unlikely(__pyx_t_16 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      if (((!__pyx_t_16) != 0)) {
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:                         <span class="k">else</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">type_</span><span class="o">.</span><span class="n">__name__</span> <span class="k">for</span> <span class="n">type_</span> <span class="ow">in</span></pre>
<pre class='cython code score-20 '>        { /* enter inner scope */
          __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 95, __pyx_L30_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
/* … */
            __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_8genexpr1__pyx_v_type_, __pyx_n_s_name);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 95, __pyx_L30_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
            if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_1, (PyObject*)__pyx_t_12))) <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L30_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr1__pyx_v_type_); __pyx_8genexpr1__pyx_v_type_ = 0;
          goto __pyx_L33_exit_scope;
          __pyx_L30_error:;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr1__pyx_v_type_); __pyx_8genexpr1__pyx_v_type_ = 0;
          goto __pyx_L1_error;
          __pyx_L33_exit_scope:;
        } /* exit inner scope */
        __pyx_t_15 = <span class='py_c_api'>PyUnicode_Join</span>(__pyx_kp_u__2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 95, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_11 = __pyx_t_15;
        __pyx_t_15 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_expected_type, __pyx_t_11);
      __pyx_t_11 = 0;
</pre><pre class="cython line score-52" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:                                         <span class="bp">self</span><span class="o">.</span><span class="n">keys_to_types</span><span class="p">[</span><span class="n">keyword</span><span class="p">]])</span></pre>
<pre class='cython code score-52 '>          if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_self)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("self"); <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L30_error)</span> }
          if (unlikely(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keys_to_types == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L30_error)</span>
          }
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_cur_scope-&gt;__pyx_v_self-&gt;keys_to_types, __pyx_v_keyword);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 96, __pyx_L30_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_12)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_12)) {
            __pyx_t_15 = __pyx_t_12; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15); __pyx_t_9 = 0;
            __pyx_t_14 = NULL;
          } else {
            __pyx_t_9 = -1; __pyx_t_15 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 96, __pyx_L30_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
            __pyx_t_14 = Py_TYPE(__pyx_t_15)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 96, __pyx_L30_error)</span>
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
          for (;;) {
            if (likely(!__pyx_t_14)) {
              if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_15))) {
                if (__pyx_t_9 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_15)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_12 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_15, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L30_error)</span>
                #else
                __pyx_t_12 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_15, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 96, __pyx_L30_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
                #endif
              } else {
                if (__pyx_t_9 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_15)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_12 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_15, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L30_error)</span>
                #else
                __pyx_t_12 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_15, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 96, __pyx_L30_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
                #endif
              }
            } else {
              __pyx_t_12 = __pyx_t_14(__pyx_t_15);
              if (unlikely(!__pyx_t_12)) {
                PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                if (exc_type) {
                  if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                  else <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L30_error)</span>
                }
                break;
              }
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
            }
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr1__pyx_v_type_, __pyx_t_12);
            __pyx_t_12 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">097</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>:                     <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Expected </span><span class="si">%s</span><span class="s"> argument to be of type </span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span></pre>
<pre class='cython code score-16 '>      __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_9 = 0;
      __pyx_t_10 = 127;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_Expected);
      __pyx_t_9 += 9;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_Expected);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_kp_u_Expected);
/* … */
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyUnicode_Join</span>(__pyx_t_11, 5, __pyx_t_9, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_TypeError, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_11, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='error_goto'>__PYX_ERR(0, 98, __pyx_L1_error)</span>
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:                                     <span class="p">(</span><span class="n">keyword</span><span class="p">,</span></pre>
<pre class='cython code score-16 '>      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Unicode</span>(__pyx_v_keyword), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 99, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_15) &gt; __pyx_t_10) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_15) : __pyx_t_10;
      __pyx_t_9 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_15);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_15);
      __pyx_t_15 = 0;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_argument_to_be_of_type);
      __pyx_t_9 += 24;
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_argument_to_be_of_type);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 2, __pyx_kp_u_argument_to_be_of_type);
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>:                                      <span class="s">&#39;or iterable of type &#39;</span> <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span></pre>
<pre class='cython code score-18 '>      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_keyword);
      __pyx_t_1 = __pyx_v_keyword;
      __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_1, __pyx_n_u_assets, Py_EQ)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L1_error)</span>
      if (!__pyx_t_7) {
      } else {
        __pyx_t_16 = __pyx_t_7;
        goto __pyx_L34_bool_binop_done;
      }
      __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_1, __pyx_n_u_fields, Py_EQ)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L1_error)</span>
      __pyx_t_16 = __pyx_t_7;
      __pyx_L34_bool_binop_done:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if ((__pyx_t_16 != 0)) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_or_iterable_of_type);
        __pyx_t_15 = __pyx_kp_u_or_iterable_of_type;
      } else {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u__3);
        __pyx_t_15 = __pyx_kp_u__3;
      }
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyUnicode_Unicode</span>(__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_1) &gt; __pyx_t_10) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_1) : __pyx_t_10;
      __pyx_t_9 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 3, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">101</span>:                                                                <span class="p">(</span><span class="s">&#39;assets&#39;</span><span class="p">,</span> <span class="s">&#39;fields&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span></pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>:                                      <span class="n">expected_type</span><span class="p">)</span></pre>
<pre class='cython code score-14 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Unicode</span>(__pyx_v_expected_type), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_10 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_1) &gt; __pyx_t_10) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_1) : __pyx_t_10;
      __pyx_t_9 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 4, __pyx_t_1);
      __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">103</span>:                                     <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>: </pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">105</span>:             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></pre>
<pre class='cython code score-11 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_cur_scope-&gt;__pyx_v_func)) { <span class='pyx_c_api'>__Pyx_RaiseClosureNameError</span>("func"); <span class='error_goto'>__PYX_ERR(0, 105, __pyx_L1_error)</span> }
  __pyx_t_5 = <span class='py_c_api'>PyDict_Copy</span>(__pyx_v_kwargs);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_cur_scope-&gt;__pyx_v_func, __pyx_v_args, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_11;
  __pyx_t_11 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">106</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">107</span>:         <span class="k">return</span> <span class="n">assert_keywords_and_call</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_assert_keywords_and_call);
  __pyx_r = __pyx_v_assert_keywords_and_call;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">108</span>: </pre>
<pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">109</span>: <span class="nd">@contextmanager</span></pre>
<pre class='cython code score-12 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_contextmanager);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 109, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
/* … */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 109, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_handle_non_market_minutes, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">110</span>: <span class="k">def</span> <span class="nf">handle_non_market_minutes</span><span class="p">(</span><span class="n">bar_data</span><span class="p">):</span></pre>
<pre class='cython code score-27 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_1handle_non_market_minutes(PyObject *__pyx_self, PyObject *__pyx_v_bar_data); /*proto*/
static PyMethodDef __pyx_mdef_7zipline_9_protocol_1handle_non_market_minutes = {"handle_non_market_minutes", (PyCFunction)__pyx_pw_7zipline_9_protocol_1handle_non_market_minutes, METH_O, 0};
static PyObject *__pyx_pw_7zipline_9_protocol_1handle_non_market_minutes(PyObject *__pyx_self, PyObject *__pyx_v_bar_data) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("handle_non_market_minutes (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_handle_non_market_minutes(__pyx_self, ((PyObject *)__pyx_v_bar_data));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_handle_non_market_minutes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_bar_data) {
  struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct_1_handle_non_market_minutes *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("handle_non_market_minutes", 0);
  __pyx_cur_scope = (struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct_1_handle_non_market_minutes *)__pyx_tp_new_7zipline_9_protocol___pyx_scope_struct_1_handle_non_market_minutes(__pyx_ptype_7zipline_9_protocol___pyx_scope_struct_1_handle_non_market_minutes, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct_1_handle_non_market_minutes *)Py_None);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L1_error)</span>
  } else {
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_cur_scope);
  }
  __pyx_cur_scope-&gt;__pyx_v_bar_data = __pyx_v_bar_data;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_cur_scope-&gt;__pyx_v_bar_data);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_cur_scope-&gt;__pyx_v_bar_data);
  {
    __pyx_CoroutineObject *gen = <span class='pyx_c_api'>__Pyx_Generator_New</span>((__pyx_coroutine_body_t) __pyx_gb_7zipline_9_protocol_2generator, __pyx_codeobj__6, (PyObject *) __pyx_cur_scope, __pyx_n_s_handle_non_market_minutes, __pyx_n_s_handle_non_market_minutes, __pyx_n_s_zipline__protocol);<span class='error_goto'> if (unlikely(!gen)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_cur_scope);
    <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.handle_non_market_minutes", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_cur_scope));
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_gb_7zipline_9_protocol_2generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("handle_non_market_minutes", 0);
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__6)
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L1_error)</span>
/* … */
  /* function exit code */
  <span class='py_c_api'>PyErr_SetNone</span>(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("handle_non_market_minutes", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  <span class='pyx_c_api'>__Pyx_Coroutine_ResetAndClearException</span>(__pyx_generator);
  #endif
  __pyx_generator-&gt;resume_label = -1;
  <span class='pyx_c_api'>__Pyx_Coroutine_clear</span>((PyObject*)__pyx_generator);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__17 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_bar_data);<span class='error_goto'> if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__17);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_7zipline_9_protocol_1handle_non_market_minutes, NULL, __pyx_n_s_zipline__protocol);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_codeobj__6 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__17, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_zipline__protocol_pyx, __pyx_n_s_handle_non_market_minutes, 110, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
/* … */
struct __pyx_obj_7zipline_9_protocol___pyx_scope_struct_1_handle_non_market_minutes {
  PyObject_HEAD
  PyObject *__pyx_v_bar_data;
};


</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">111</span>:     <span class="k">try</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  /*try:*/ {
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">112</span>:         <span class="n">bar_data</span><span class="o">.</span><span class="n">_handle_non_market_minutes</span> <span class="o">=</span> <span class="bp">True</span></pre>
<pre class='cython code score-2 '>    if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(__pyx_cur_scope-&gt;__pyx_v_bar_data, __pyx_n_s_handle_non_market_minutes_2, Py_True) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L5_error)</span>
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">113</span>:         <span class="k">yield</span></pre>
<pre class='cython code score-3 '>    __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
    <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
    <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
    <span class='pyx_c_api'>__Pyx_Coroutine_ResetAndClearException</span>(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator-&gt;resume_label = 1;
    return __pyx_r;
    __pyx_L7_resume_from_yield:;
    if (unlikely(!__pyx_sent_value)) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L5_error)</span>
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">114</span>:     <span class="k">finally</span><span class="p">:</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">115</span>:         <span class="n">bar_data</span><span class="o">.</span><span class="n">_handle_non_market_minutes</span> <span class="o">=</span> <span class="bp">False</span></pre>
<pre class='cython code score-19 '>  /*finally:*/ {
    /*normal exit:*/{
      if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(__pyx_cur_scope-&gt;__pyx_v_bar_data, __pyx_n_s_handle_non_market_minutes_2, Py_False) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L1_error)</span>
      goto __pyx_L6;
    }
    __pyx_L5_error:;
    /*exception exit:*/{
      __Pyx_PyThreadState_assign
      __pyx_t_4 = 0; __pyx_t_5 = 0; __pyx_t_6 = 0; __pyx_t_7 = 0; __pyx_t_8 = 0; __pyx_t_9 = 0;
      if (PY_MAJOR_VERSION &gt;= 3) <span class='pyx_c_api'>__Pyx_ExceptionSwap</span>(&amp;__pyx_t_7, &amp;__pyx_t_8, &amp;__pyx_t_9);
      if ((PY_MAJOR_VERSION &lt; 3) || unlikely(<span class='pyx_c_api'>__Pyx_GetException</span>(&amp;__pyx_t_4, &amp;__pyx_t_5, &amp;__pyx_t_6) &lt; 0)) <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_t_4, &amp;__pyx_t_5, &amp;__pyx_t_6);
      <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_4);
      <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_6);
      <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_7);
      <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);
      <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_9);
      __pyx_t_1 = __pyx_lineno; __pyx_t_2 = __pyx_clineno; __pyx_t_3 = __pyx_filename;
      {
        if (<span class='pyx_c_api'>__Pyx_PyObject_SetAttrStr</span>(__pyx_cur_scope-&gt;__pyx_v_bar_data, __pyx_n_s_handle_non_market_minutes_2, Py_False) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L9_error)</span>
      }
      if (PY_MAJOR_VERSION &gt;= 3) {
        <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_7);
        <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_8);
        <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_9);
        <span class='pyx_c_api'>__Pyx_ExceptionReset</span>(__pyx_t_7, __pyx_t_8, __pyx_t_9);
      }
      <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_4);
      <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_5);
      <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_6);
      <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6);
      __pyx_t_4 = 0; __pyx_t_5 = 0; __pyx_t_6 = 0; __pyx_t_7 = 0; __pyx_t_8 = 0; __pyx_t_9 = 0;
      __pyx_lineno = __pyx_t_1; __pyx_clineno = __pyx_t_2; __pyx_filename = __pyx_t_3;
      goto __pyx_L1_error;
      __pyx_L9_error:;
      if (PY_MAJOR_VERSION &gt;= 3) {
        <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_7);
        <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_8);
        <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_9);
        <span class='pyx_c_api'>__Pyx_ExceptionReset</span>(__pyx_t_7, __pyx_t_8, __pyx_t_9);
      }
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = 0; __pyx_t_8 = 0; __pyx_t_9 = 0;
      goto __pyx_L1_error;
    }
    __pyx_L6:;
  }
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
</pre><pre class="cython line score-0">&#xA0;<span class="">116</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">117</span>: <span class="k">cdef</span> <span class="k">class</span> <span class="nf">BarData</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>struct __pyx_obj_7zipline_9_protocol_BarData {
  PyObject_HEAD
  struct __pyx_vtabstruct_7zipline_9_protocol_BarData *__pyx_vtab;
  PyObject *data_portal;
  PyObject *simulation_dt_func;
  PyObject *data_frequency;
  PyObject *restrictions;
  PyObject *_views;
  PyBoolObject *_daily_mode;
  PyObject *_trading_calendar;
  PyObject *_is_restricted;
  PyBoolObject *_adjust_minutes;
};
/* … */
struct __pyx_vtabstruct_7zipline_9_protocol_BarData {
  PyObject *(*_get_current_minute)(struct __pyx_obj_7zipline_9_protocol_BarData *);
  PyBoolObject *(*_can_trade_for_asset)(struct __pyx_obj_7zipline_9_protocol_BarData *, PyObject *, PyObject *, PyObject *, PyObject *);
  PyBoolObject *(*_is_stale_for_asset)(struct __pyx_obj_7zipline_9_protocol_BarData *, PyObject *, PyObject *, PyObject *, PyObject *);
};
static struct __pyx_vtabstruct_7zipline_9_protocol_BarData *__pyx_vtabptr_7zipline_9_protocol_BarData;
</pre><pre class="cython line score-0">&#xA0;<span class="">118</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>: <span class="sd">    Provides methods for accessing minutely and daily price/volume data from</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: <span class="sd">    Algorithm API functions.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>: <span class="sd">    Also provides utility methods to determine if an asset is alive, and if it</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>: <span class="sd">    has recent trade data.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: <span class="sd">    An instance of this object is passed as ``data`` to</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: <span class="sd">    :func:`~zipline.api.handle_data` and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: <span class="sd">    :func:`~zipline.api.before_trading_start`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>: <span class="sd">    Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>: <span class="sd">    ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>: <span class="sd">    data_portal : DataPortal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>: <span class="sd">        Provider for bar pricing data.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>: <span class="sd">    simulation_dt_func : callable</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>: <span class="sd">        Function which returns the current simulation time.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>: <span class="sd">        This is usually bound to a method of TradingSimulation.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: <span class="sd">    data_frequency : {&#39;minute&#39;, &#39;daily&#39;}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>: <span class="sd">        The frequency of the bar data; i.e. whether the data is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>: <span class="sd">        daily or minute bars</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>: <span class="sd">    restrictions : zipline.finance.asset_restrictions.Restrictions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">140</span>: <span class="sd">        Object that combines and returns restricted list information from</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">141</span>: <span class="sd">        multiple sources</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:     <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">data_portal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>:     <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">simulation_dt_func</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>:     <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">data_frequency</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>:     <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">restrictions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:     <span class="k">cdef</span> <span class="kt">dict</span> <span class="nf">_views</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:     <span class="k">cdef</span> <span class="kt">bool</span> <span class="nf">_daily_mode</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>:     <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">_trading_calendar</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:     <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">_is_restricted</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>:     <span class="k">cdef</span> <span class="kt">bool</span> <span class="nf">_adjust_minutes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>: </pre>
<pre class="cython line score-45" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>:     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_portal</span><span class="p">,</span> <span class="n">simulation_dt_func</span><span class="p">,</span> <span class="n">data_frequency</span><span class="p">,</span></pre>
<pre class='cython code score-45 '>/* Python wrapper */
static int __pyx_pw_7zipline_9_protocol_7BarData_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7zipline_9_protocol_7BarData_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_data_portal = 0;
  PyObject *__pyx_v_simulation_dt_func = 0;
  PyObject *__pyx_v_data_frequency = 0;
  PyObject *__pyx_v_trading_calendar = 0;
  PyObject *__pyx_v_restrictions = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_data_portal,&amp;__pyx_n_s_simulation_dt_func,&amp;__pyx_n_s_data_frequency,&amp;__pyx_n_s_trading_calendar,&amp;__pyx_n_s_restrictions,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_data_portal)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_simulation_dt_func)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_data_frequency)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_trading_calendar)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_restrictions)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_data_portal = values[0];
    __pyx_v_simulation_dt_func = values[1];
    __pyx_v_data_frequency = values[2];
    __pyx_v_trading_calendar = values[3];
    __pyx_v_restrictions = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData___init__(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self), __pyx_v_data_portal, __pyx_v_simulation_dt_func, __pyx_v_data_frequency, __pyx_v_trading_calendar, __pyx_v_restrictions);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_7zipline_9_protocol_7BarData___init__(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_data_portal, PyObject *__pyx_v_simulation_dt_func, PyObject *__pyx_v_data_frequency, PyObject *__pyx_v_trading_calendar, PyObject *__pyx_v_restrictions) {
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 154, 0, <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">155</span>:                  <span class="n">trading_calendar</span><span class="p">,</span> <span class="n">restrictions</span><span class="p">):</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">156</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span> <span class="o">=</span> <span class="n">data_portal</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data_portal);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_data_portal);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;data_portal);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;data_portal);
  __pyx_v_self-&gt;data_portal = __pyx_v_data_portal;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">157</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span> <span class="o">=</span> <span class="n">simulation_dt_func</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_simulation_dt_func);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_simulation_dt_func);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  __pyx_v_self-&gt;simulation_dt_func = __pyx_v_simulation_dt_func;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span> <span class="o">=</span> <span class="n">data_frequency</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_data_frequency);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_data_frequency);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;data_frequency);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;data_frequency);
  __pyx_v_self-&gt;data_frequency = __pyx_v_data_frequency;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">159</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">_views</span> <span class="o">=</span> <span class="p">{}</span></pre>
<pre class='cython code score-3 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 159, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;_views);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;_views);
  __pyx_v_self-&gt;_views = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">160</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">161</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">_daily_mode</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span> <span class="o">==</span> <span class="s">&quot;daily&quot;</span><span class="p">)</span></pre>
<pre class='cython code score-6 '>  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_self-&gt;data_frequency, __pyx_n_u_daily, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 161, __pyx_L1_error)
  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7cpython_4bool_bool))))) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;_daily_mode);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self-&gt;_daily_mode));
  __pyx_v_self-&gt;_daily_mode = ((PyBoolObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">162</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span> <span class="o">=</span> <span class="bp">False</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_False);
  <span class='refnanny'>__Pyx_GIVEREF</span>(Py_False);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;_adjust_minutes);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes));
  __pyx_v_self-&gt;_adjust_minutes = ((PyBoolObject *)Py_False);
</pre><pre class="cython line score-0">&#xA0;<span class="">164</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">_trading_calendar</span> <span class="o">=</span> <span class="n">trading_calendar</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_trading_calendar);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_trading_calendar);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;_trading_calendar);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;_trading_calendar);
  __pyx_v_self-&gt;_trading_calendar = __pyx_v_trading_calendar;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">_is_restricted</span> <span class="o">=</span> <span class="n">restrictions</span><span class="o">.</span><span class="n">is_restricted</span></pre>
<pre class='cython code score-3 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_restrictions, __pyx_n_s_is_restricted);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;_is_restricted);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;_is_restricted);
  __pyx_v_self-&gt;_is_restricted = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">167</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:     <span class="k">cdef</span> <span class="nf">_get_current_minute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre>
<pre class='cython code score-6 '>static PyObject *__pyx_f_7zipline_9_protocol_7BarData__get_current_minute(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self) {
  PyObject *__pyx_v_dt = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_get_current_minute", 0);
  <span class='trace'>__Pyx_TraceCall</span>("_get_current_minute", __pyx_f[0], 168, 0, <span class='error_goto'>__PYX_ERR(0, 168, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData._get_current_minute", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dt);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">169</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">170</span>: <span class="sd">        Internal utility method to get the current simulation time.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">171</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>: <span class="sd">        Possible answers are:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>: <span class="sd">        - whatever the algorithm&#39;s get_datetime() method returns (this is what</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>: <span class="sd">            `self.simulation_dt_func()` points to)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>: <span class="sd">        - sometimes we&#39;re knowingly not in a market minute, like if we&#39;re in</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>: <span class="sd">            before_trading_start.  In that case, `self._adjust_minutes` is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">177</span>: <span class="sd">            True, and we get the previous market minute.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>: <span class="sd">        - if we&#39;re in daily mode, get the session label for this minute.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">180</span>:         <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">()</span></pre>
<pre class='cython code score-17 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  __pyx_t_2 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 180, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dt = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">181</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">182</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 182, __pyx_L1_error)</span>
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">183</span>:             <span class="n">dt</span> <span class="o">=</span> <span class="w">\</span></pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">trading_calendar</span><span class="o">.</span><span class="n">previous_minute</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></pre>
<pre class='cython code score-20 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_trading_calendar);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 184, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_previous_minute);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 184, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_dt) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_v_dt);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 184, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dt, __pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">185</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">186</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_daily_mode</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_daily_mode)); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 186, __pyx_L1_error)</span>
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">187</span>:             <span class="c"># if we&#39;re in daily mode, take the given dt (which is the last</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>:             <span class="c"># minute of the session) and get the session label for it.</span></pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">189</span>:             <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">trading_calendar</span><span class="o">.</span><span class="n">minute_to_session_label</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></pre>
<pre class='cython code score-20 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_trading_calendar);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_minute_to_session_label);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_dt) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_v_dt);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dt, __pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">190</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>:         <span class="k">return</span> <span class="n">dt</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dt);
  __pyx_r = __pyx_v_dt;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">192</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:     <span class="nd">@check_parameters</span><span class="p">((</span><span class="s">&#39;assets&#39;</span><span class="p">,</span> <span class="s">&#39;fields&#39;</span><span class="p">),</span></pre>
<pre class='cython code score-16 '>  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__18);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__18);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_tuple__18);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7zipline_9_protocol_check_parameters), __pyx_t_1, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_tuple__18 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_assets, __pyx_n_u_fields);<span class='error_goto'> if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__18);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__18);
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>:                       <span class="p">((</span><span class="n">Asset</span><span class="p">,</span> <span class="n">ContinuousFuture</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="p">(</span><span class="nb">str</span><span class="p">,)))</span></pre>
<pre class='cython code score-26 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_ContinuousFuture);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)(&amp;PyUnicode_Type)));
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)(&amp;PyUnicode_Type)));
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 194, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_2 = 0;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-77" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:     <span class="k">def</span> <span class="nf">current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span></pre>
<pre class='cython code score-77 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_3current(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7zipline_9_protocol_7BarData_2current[] = "\n        Returns the \"current\" value of the given fields for the given assets\n        at the current simulation time.\n\n        Parameters\n        ----------\n        assets : zipline.assets.Asset or iterable of zipline.assets.Asset\n            The asset(s) for which data is requested.\n        fields : str or iterable[str].\n            Requested data field(s). Valid field names are: \"price\",\n            \"open_price\", \"high_price\", \"low_price\", \"last_traded\",\n            \"open\", \"high\", \"low\", \"close\", and \"volume\".\n\n        Returns\n        -------\n        current_value : Scalar, pandas Series, or pandas DataFrame.\n            See notes below.\n\n        Notes\n        -----\n        The return type of this function depends on the types of its inputs:\n\n        - If a single asset and a single field are requested, the returned\n          value is a scalar (either a float or a ``pd.Timestamp`` depending on\n          the field).\n\n        - If a single asset and a list of fields are requested, the returned\n          value is a :class:`pd.Series` whose indices are the requested fields.\n\n        - If a list of assets and a single field are requested, the returned\n          value is a :class:`pd.Series` whose indices are the assets.\n\n        - If a list of assets and a list of fields are requested, the returned\n          value is a :class:`pd.DataFrame`.  The columns of the returned frame\n          will be the requested fields, and the index of the frame will be the\n          requested assets.\n\n        The values produced for ``fields`` are as follows:\n\n        - Requesting \"price\"/\"open_price\"/\"high_price\"/\"low_price\"\n          produces the last known \"close\"/\"open\"/\"high\"/\"low\" for the asset,\n          forward-filled from an earlier minute if there is no trade this\n          minute. If there is no last known value (either because the asset\n          has never traded, or because it has delisted) NaN ""is returned. If a\n          value is found, and we had to cross an adjustment boundary (split,\n          dividend, etc) to get it, the value is adjusted to the current\n          simulation time before being returned.\n\n        - Requesting \"open\", \"high\", \"low\", or \"close\" produces the open, high,\n          low, or close for the current minute. If no trades occurred this\n          minute, ``NaN`` is returned.\n\n        - Requesting \"volume\" produces the trade volume for the current\n          minute. If no trades occurred this minute, 0 is returned.\n\n        - Requesting \"last_traded\" produces the datetime of the last minute in\n          which the asset traded, even if the asset has stopped trading. If\n          there is no last known value, ``pd.NaT`` is returned.\n\n        If the current simulation time is not a valid market time for an asset,\n        we use the most recent market close instead.\n        ";
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_3current(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_assets = 0;
  PyObject *__pyx_v_fields = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("current (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_assets,&amp;__pyx_n_s_fields,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_assets)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_fields)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("current", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "current") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_assets = values[0];
    __pyx_v_fields = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("current", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.current", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_2current(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self), __pyx_v_assets, __pyx_v_fields);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_2current(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_assets, PyObject *__pyx_v_fields) {
  PyBoolObject *__pyx_v_multiple_assets = NULL;
  PyBoolObject *__pyx_v_multiple_fields = NULL;
  PyObject *__pyx_v_asset = NULL;
  PyObject *__pyx_v_field = NULL;
  PyObject *__pyx_v_data = NULL;
  PyObject *__pyx_v_series = NULL;
  PyObject *__pyx_8genexpr2__pyx_v_field = NULL;
  PyObject *__pyx_8genexpr3__pyx_v_field = NULL;
  PyObject *__pyx_8genexpr4__pyx_v_asset = NULL;
  PyObject *__pyx_8genexpr5__pyx_v_asset = NULL;
  PyObject *__pyx_8genexpr6__pyx_v_asset = NULL;
  PyObject *__pyx_8genexpr7__pyx_v_asset = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("current", 0);
  <span class='trace'>__Pyx_TraceCall</span>("current", __pyx_f[0], 195, 0, <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.current", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_multiple_assets);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_multiple_fields);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_asset);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_field);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_series);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr2__pyx_v_field);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr3__pyx_v_field);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr4__pyx_v_asset);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr5__pyx_v_asset);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr6__pyx_v_asset);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr7__pyx_v_asset);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  <span class='pyx_c_api'>__Pyx_GetNameInClass</span>(__pyx_t_1, (PyObject *)__pyx_ptype_7zipline_9_protocol_BarData, __pyx_n_s_current);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>((PyObject *)__pyx_ptype_7zipline_9_protocol_BarData-&gt;tp_dict, __pyx_n_s_current, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='py_c_api'>PyType_Modified</span>(__pyx_ptype_7zipline_9_protocol_BarData);
</pre><pre class="cython line score-0">&#xA0;<span class="">196</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">197</span>: <span class="sd">        Returns the &quot;current&quot; value of the given fields for the given assets</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">198</span>: <span class="sd">        at the current simulation time.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">199</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>: <span class="sd">        Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>: <span class="sd">        ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">202</span>: <span class="sd">        assets : zipline.assets.Asset or iterable of zipline.assets.Asset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">203</span>: <span class="sd">            The asset(s) for which data is requested.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">204</span>: <span class="sd">        fields : str or iterable[str].</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">205</span>: <span class="sd">            Requested data field(s). Valid field names are: &quot;price&quot;,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: <span class="sd">            &quot;open_price&quot;, &quot;high_price&quot;, &quot;low_price&quot;, &quot;last_traded&quot;,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">207</span>: <span class="sd">            &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, and &quot;volume&quot;.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">208</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">209</span>: <span class="sd">        Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">210</span>: <span class="sd">        -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">211</span>: <span class="sd">        current_value : Scalar, pandas Series, or pandas DataFrame.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>: <span class="sd">            See notes below.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">214</span>: <span class="sd">        Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>: <span class="sd">        -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>: <span class="sd">        The return type of this function depends on the types of its inputs:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">218</span>: <span class="sd">        - If a single asset and a single field are requested, the returned</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>: <span class="sd">          value is a scalar (either a float or a ``pd.Timestamp`` depending on</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">220</span>: <span class="sd">          the field).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">222</span>: <span class="sd">        - If a single asset and a list of fields are requested, the returned</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">223</span>: <span class="sd">          value is a :class:`pd.Series` whose indices are the requested fields.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">224</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">225</span>: <span class="sd">        - If a list of assets and a single field are requested, the returned</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>: <span class="sd">          value is a :class:`pd.Series` whose indices are the assets.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>: <span class="sd">        - If a list of assets and a list of fields are requested, the returned</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>: <span class="sd">          value is a :class:`pd.DataFrame`.  The columns of the returned frame</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>: <span class="sd">          will be the requested fields, and the index of the frame will be the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>: <span class="sd">          requested assets.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>: <span class="sd">        The values produced for ``fields`` are as follows:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>: <span class="sd">        - Requesting &quot;price&quot;/&quot;open_price&quot;/&quot;high_price&quot;/&quot;low_price&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>: <span class="sd">          produces the last known &quot;close&quot;/&quot;open&quot;/&quot;high&quot;/&quot;low&quot; for the asset,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>: <span class="sd">          forward-filled from an earlier minute if there is no trade this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">238</span>: <span class="sd">          minute. If there is no last known value (either because the asset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">239</span>: <span class="sd">          has never traded, or because it has delisted) NaN is returned. If a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>: <span class="sd">          value is found, and we had to cross an adjustment boundary (split,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>: <span class="sd">          dividend, etc) to get it, the value is adjusted to the current</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">242</span>: <span class="sd">          simulation time before being returned.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>: <span class="sd">        - Requesting &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, or &quot;close&quot; produces the open, high,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">245</span>: <span class="sd">          low, or close for the current minute. If no trades occurred this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">246</span>: <span class="sd">          minute, ``NaN`` is returned.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">247</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">248</span>: <span class="sd">        - Requesting &quot;volume&quot; produces the trade volume for the current</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>: <span class="sd">          minute. If no trades occurred this minute, 0 is returned.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>: <span class="sd">        - Requesting &quot;last_traded&quot; produces the datetime of the last minute in</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>: <span class="sd">          which the asset traded, even if the asset has stopped trading. If</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>: <span class="sd">          there is no last known value, ``pd.NaT`` is returned.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>: <span class="sd">        If the current simulation time is not a valid market time for an asset,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>: <span class="sd">        we use the most recent market close instead.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">258</span>:         <span class="n">multiple_assets</span> <span class="o">=</span> <span class="n">_is_iterable</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((PyObject *)__pyx_f_7zipline_9_protocol__is_iterable(__pyx_v_assets));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 258, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_multiple_assets = ((PyBoolObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>:         <span class="n">multiple_fields</span> <span class="o">=</span> <span class="n">_is_iterable</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((PyObject *)__pyx_f_7zipline_9_protocol__is_iterable(__pyx_v_fields));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_multiple_fields = ((PyBoolObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">260</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">261</span>:         <span class="c"># There&#39;s some overly verbose code in here, particularly around</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">262</span>:         <span class="c"># &#39;do something if self._adjust_minutes is False, otherwise do</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">263</span>:         <span class="c"># something else&#39;. This could be less verbose, but the 99% case is that</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">264</span>:         <span class="c"># `self._adjust_minutes` is False, so it&#39;s important to keep that code</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>:         <span class="c"># path as fast as possible.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">266</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>:         <span class="c"># There&#39;s probably a way to make this method (and `history`) less</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">268</span>:         <span class="c"># verbose, but this is OK for now.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">270</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="n">multiple_assets</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_multiple_assets)); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 270, __pyx_L1_error)</span>
  __pyx_t_3 = ((!__pyx_t_2) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">271</span>:             <span class="n">asset</span> <span class="o">=</span> <span class="n">assets</span></pre>
<pre class='cython code score-1 '>    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_assets);
    __pyx_v_asset = __pyx_v_assets;
</pre><pre class="cython line score-0">&#xA0;<span class="">272</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">273</span>:             <span class="k">if</span> <span class="ow">not</span> <span class="n">multiple_fields</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_multiple_fields)); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 273, __pyx_L1_error)</span>
    __pyx_t_2 = ((!__pyx_t_3) != 0);
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">274</span>:                 <span class="n">field</span> <span class="o">=</span> <span class="n">fields</span></pre>
<pre class='cython code score-1 '>      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_fields);
      __pyx_v_field = __pyx_v_fields;
</pre><pre class="cython line score-0">&#xA0;<span class="">275</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>:                 <span class="c"># return scalar value</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>:                 <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 277, __pyx_L1_error)</span>
      __pyx_t_3 = ((!__pyx_t_2) != 0);
      if (__pyx_t_3) {
/* … */
      }
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">278</span>:                     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_spot_value</span><span class="p">(</span></pre>
<pre class='cython code score-3 '>        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_spot_value);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 278, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-0">&#xA0;<span class="">279</span>:                         <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">280</span>:                         <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">281</span>:                         <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>        __pyx_t_5 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
</pre><pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">282</span>:                         <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-42 '>        __pyx_t_6 = NULL;
        __pyx_t_7 = 0;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
          __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
          if (likely(__pyx_t_6)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
            __pyx_t_7 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
          PyObject *__pyx_temp[5] = {__pyx_t_6, __pyx_v_asset, __pyx_v_field, __pyx_t_5, __pyx_v_self-&gt;data_frequency};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 278, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
          PyObject *__pyx_temp[5] = {__pyx_t_6, __pyx_v_asset, __pyx_v_field, __pyx_t_5, __pyx_v_self-&gt;data_frequency};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 278, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        {
          __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 278, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
          if (__pyx_t_6) {
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_7, __pyx_v_asset);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_field);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_field);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_7, __pyx_v_field);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2+__pyx_t_7, __pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 3+__pyx_t_7, __pyx_v_self-&gt;data_frequency);
          __pyx_t_5 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 278, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_1;
        __pyx_t_1 = 0;
        goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">283</span>:                     <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>:                     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_adjusted_value</span><span class="p">(</span></pre>
<pre class='cython code score-3 '>      /*else*/ {
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_adjusted_value);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-0">&#xA0;<span class="">286</span>:                         <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">287</span>:                         <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">288</span>:                         <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>        __pyx_t_8 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 288, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">289</span>:                         <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">(),</span></pre>
<pre class='cython code score-17 '>        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
        __pyx_t_6 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_9 = NULL;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
          __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
          if (likely(__pyx_t_9)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
          }
        }
        __pyx_t_5 = (__pyx_t_9) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_9) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 289, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-45" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">290</span>:                         <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-45 '>        __pyx_t_6 = NULL;
        __pyx_t_7 = 0;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
          __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
          if (likely(__pyx_t_6)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
            __pyx_t_7 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
          PyObject *__pyx_temp[6] = {__pyx_t_6, __pyx_v_asset, __pyx_v_field, __pyx_t_8, __pyx_t_5, __pyx_v_self-&gt;data_frequency};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
          PyObject *__pyx_temp[6] = {__pyx_t_6, __pyx_v_asset, __pyx_v_field, __pyx_t_8, __pyx_t_5, __pyx_v_self-&gt;data_frequency};
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        } else
        #endif
        {
          __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          if (__pyx_t_6) {
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_6); __pyx_t_6 = NULL;
          }
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_7, __pyx_v_asset);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_field);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_field);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_7, __pyx_v_field);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 2+__pyx_t_7, __pyx_t_8);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 3+__pyx_t_7, __pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 4+__pyx_t_7, __pyx_v_self-&gt;data_frequency);
          __pyx_t_8 = 0;
          __pyx_t_5 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_1;
        __pyx_t_1 = 0;
        goto __pyx_L0;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">291</span>:                     <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">293</span>:                 <span class="c"># assume fields is iterable</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>:                 <span class="c"># return a Series indexed by field</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">295</span>:                 <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    /*else*/ {
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 295, __pyx_L1_error)</span>
      __pyx_t_2 = ((!__pyx_t_3) != 0);
      if (__pyx_t_2) {
/* … */
      }
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">296</span>:                     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span></pre>
<pre class='cython code score-17 '>        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 296, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_Series);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 296, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 296, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        { /* enter inner scope */
          __pyx_t_9 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 296, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
/* … */
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_empty_tuple, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 296, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_r = __pyx_t_9;
        __pyx_t_9 = 0;
        goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">297</span>:                         <span class="n">field</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_spot_value</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_spot_value);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 297, __pyx_L9_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
</pre><pre class="cython line score-0">&#xA0;<span class="">298</span>:                             <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>:                             <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">300</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>            __pyx_t_12 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 300, __pyx_L9_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
</pre><pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">301</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-48 '>            __pyx_t_13 = NULL;
            __pyx_t_7 = 0;
            if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
              __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
              if (likely(__pyx_t_13)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
                __pyx_t_7 = 1;
              }
            }
            #if CYTHON_FAST_PYCALL
            if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
              PyObject *__pyx_temp[5] = {__pyx_t_13, __pyx_v_asset, __pyx_8genexpr2__pyx_v_field, __pyx_t_12, __pyx_v_self-&gt;data_frequency};
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 297, __pyx_L9_error)</span>
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
            } else
            #endif
            #if CYTHON_FAST_PYCCALL
            if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
              PyObject *__pyx_temp[5] = {__pyx_t_13, __pyx_v_asset, __pyx_8genexpr2__pyx_v_field, __pyx_t_12, __pyx_v_self-&gt;data_frequency};
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 297, __pyx_L9_error)</span>
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
            } else
            #endif
            {
              __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 297, __pyx_L9_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
              if (__pyx_t_13) {
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_13); __pyx_t_13 = NULL;
              }
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+__pyx_t_7, __pyx_v_asset);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_8genexpr2__pyx_v_field);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_8genexpr2__pyx_v_field);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1+__pyx_t_7, __pyx_8genexpr2__pyx_v_field);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 2+__pyx_t_7, __pyx_t_12);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 3+__pyx_t_7, __pyx_v_self-&gt;data_frequency);
              __pyx_t_12 = 0;
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 297, __pyx_L9_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
            }
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, (PyObject*)__pyx_8genexpr2__pyx_v_field, (PyObject*)__pyx_t_8))) <span class='error_goto'>__PYX_ERR(0, 297, __pyx_L9_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">302</span>:                         <span class="p">)</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">303</span>:                         <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span></pre>
<pre class='cython code score-51 '>          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_fields)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_fields)) {
            __pyx_t_5 = __pyx_v_fields; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_10 = 0;
            __pyx_t_11 = NULL;
          } else {
            __pyx_t_10 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_fields);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 303, __pyx_L9_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_11 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 303, __pyx_L9_error)</span>
          }
          for (;;) {
            if (likely(!__pyx_t_11)) {
              if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
                if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 303, __pyx_L9_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 303, __pyx_L9_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              } else {
                if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 303, __pyx_L9_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 303, __pyx_L9_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              }
            } else {
              __pyx_t_8 = __pyx_t_11(__pyx_t_5);
              if (unlikely(!__pyx_t_8)) {
                PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                if (exc_type) {
                  if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                  else <span class='error_goto'>__PYX_ERR(0, 303, __pyx_L9_error)</span>
                }
                break;
              }
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
            }
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr2__pyx_v_field, __pyx_t_8);
            __pyx_t_8 = 0;
/* … */
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr2__pyx_v_field); __pyx_8genexpr2__pyx_v_field = 0;
          goto __pyx_L12_exit_scope;
          __pyx_L9_error:;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr2__pyx_v_field); __pyx_8genexpr2__pyx_v_field = 0;
          goto __pyx_L1_error;
          __pyx_L12_exit_scope:;
        } /* exit inner scope */
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_data, __pyx_t_9) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 296, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:                     <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">assets</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span></pre>
<pre class='cython code score-13 '>        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_index, __pyx_v_fields) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 296, __pyx_L1_error)</span>
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_assets, __pyx_n_s_symbol);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 304, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_name_2, __pyx_t_9) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 296, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">305</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">306</span>:                     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span></pre>
<pre class='cython code score-17 '>      /*else*/ {
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 306, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_Series);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 306, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 306, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        { /* enter inner scope */
          __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 306, __pyx_L15_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
/* … */
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_empty_tuple, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 306, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_r = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L0;
      }
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>:                         <span class="n">field</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_adjusted_value</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_adjusted_value);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 307, __pyx_L15_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
</pre><pre class="cython line score-0">&#xA0;<span class="">308</span>:                             <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">309</span>:                             <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>            __pyx_t_14 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 310, __pyx_L15_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">(),</span></pre>
<pre class='cython code score-17 '>            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
            __pyx_t_13 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_15 = NULL;
            if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
              __pyx_t_15 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
              if (likely(__pyx_t_15)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_15);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
              }
            }
            __pyx_t_12 = (__pyx_t_15) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, __pyx_t_15) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_13);
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
            if (unlikely(!__pyx_t_12)) <span class='error_goto'>__PYX_ERR(0, 311, __pyx_L15_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
</pre><pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">312</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-51 '>            __pyx_t_13 = NULL;
            __pyx_t_7 = 0;
            if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
              __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
              if (likely(__pyx_t_13)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
                __pyx_t_7 = 1;
              }
            }
            #if CYTHON_FAST_PYCALL
            if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
              PyObject *__pyx_temp[6] = {__pyx_t_13, __pyx_v_asset, __pyx_8genexpr3__pyx_v_field, __pyx_t_14, __pyx_t_12, __pyx_v_self-&gt;data_frequency};
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 307, __pyx_L15_error)</span>
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
            } else
            #endif
            #if CYTHON_FAST_PYCCALL
            if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
              PyObject *__pyx_temp[6] = {__pyx_t_13, __pyx_v_asset, __pyx_8genexpr3__pyx_v_field, __pyx_t_14, __pyx_t_12, __pyx_v_self-&gt;data_frequency};
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 307, __pyx_L15_error)</span>
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
            } else
            #endif
            {
              __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 307, __pyx_L15_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
              if (__pyx_t_13) {
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_13); __pyx_t_13 = NULL;
              }
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+__pyx_t_7, __pyx_v_asset);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_8genexpr3__pyx_v_field);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_8genexpr3__pyx_v_field);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1+__pyx_t_7, __pyx_8genexpr3__pyx_v_field);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 2+__pyx_t_7, __pyx_t_14);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 3+__pyx_t_7, __pyx_t_12);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 4+__pyx_t_7, __pyx_v_self-&gt;data_frequency);
              __pyx_t_14 = 0;
              __pyx_t_12 = 0;
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 307, __pyx_L15_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
            }
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, (PyObject*)__pyx_8genexpr3__pyx_v_field, (PyObject*)__pyx_t_8))) <span class='error_goto'>__PYX_ERR(0, 307, __pyx_L15_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">313</span>:                         <span class="p">)</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">314</span>:                         <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span></pre>
<pre class='cython code score-51 '>          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_fields)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_fields)) {
            __pyx_t_5 = __pyx_v_fields; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_10 = 0;
            __pyx_t_11 = NULL;
          } else {
            __pyx_t_10 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_fields);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 314, __pyx_L15_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_11 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 314, __pyx_L15_error)</span>
          }
          for (;;) {
            if (likely(!__pyx_t_11)) {
              if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
                if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L15_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 314, __pyx_L15_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              } else {
                if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L15_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 314, __pyx_L15_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              }
            } else {
              __pyx_t_8 = __pyx_t_11(__pyx_t_5);
              if (unlikely(!__pyx_t_8)) {
                PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                if (exc_type) {
                  if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                  else <span class='error_goto'>__PYX_ERR(0, 314, __pyx_L15_error)</span>
                }
                break;
              }
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
            }
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr3__pyx_v_field, __pyx_t_8);
            __pyx_t_8 = 0;
/* … */
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr3__pyx_v_field); __pyx_8genexpr3__pyx_v_field = 0;
          goto __pyx_L18_exit_scope;
          __pyx_L15_error:;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr3__pyx_v_field); __pyx_8genexpr3__pyx_v_field = 0;
          goto __pyx_L1_error;
          __pyx_L18_exit_scope:;
        } /* exit inner scope */
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, __pyx_n_s_data, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">315</span>:                     <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">assets</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span></pre>
<pre class='cython code score-13 '>        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, __pyx_n_s_index, __pyx_v_fields) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span>
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_assets, __pyx_n_s_symbol);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 315, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, __pyx_n_s_name_2, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">316</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">317</span>:             <span class="k">if</span> <span class="ow">not</span> <span class="n">multiple_fields</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  /*else*/ {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_multiple_fields)); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 317, __pyx_L1_error)</span>
    __pyx_t_3 = ((!__pyx_t_2) != 0);
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>:                 <span class="n">field</span> <span class="o">=</span> <span class="n">fields</span></pre>
<pre class='cython code score-1 '>      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_fields);
      __pyx_v_field = __pyx_v_fields;
</pre><pre class="cython line score-0">&#xA0;<span class="">319</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">320</span>:                 <span class="c"># assume assets is iterable</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">321</span>:                 <span class="c"># return a Series indexed by asset</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">322</span>:                 <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 322, __pyx_L1_error)</span>
      __pyx_t_2 = ((!__pyx_t_3) != 0);
      if (__pyx_t_2) {
/* … */
      }
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">323</span>:                     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span></pre>
<pre class='cython code score-17 '>        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 323, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_Series);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 323, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 323, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        { /* enter inner scope */
          __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 323, __pyx_L23_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
/* … */
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_empty_tuple, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 323, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_r = __pyx_t_1;
        __pyx_t_1 = 0;
        goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">324</span>:                         <span class="n">asset</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_spot_value</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_spot_value);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 324, __pyx_L23_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
</pre><pre class="cython line score-0">&#xA0;<span class="">325</span>:                             <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">326</span>:                             <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">327</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>            __pyx_t_15 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 327, __pyx_L23_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
</pre><pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">328</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-48 '>            __pyx_t_12 = NULL;
            __pyx_t_7 = 0;
            if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
              __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
              if (likely(__pyx_t_12)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
                __pyx_t_7 = 1;
              }
            }
            #if CYTHON_FAST_PYCALL
            if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
              PyObject *__pyx_temp[5] = {__pyx_t_12, __pyx_8genexpr4__pyx_v_asset, __pyx_v_field, __pyx_t_15, __pyx_v_self-&gt;data_frequency};
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 324, __pyx_L23_error)</span>
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
            } else
            #endif
            #if CYTHON_FAST_PYCCALL
            if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
              PyObject *__pyx_temp[5] = {__pyx_t_12, __pyx_8genexpr4__pyx_v_asset, __pyx_v_field, __pyx_t_15, __pyx_v_self-&gt;data_frequency};
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 324, __pyx_L23_error)</span>
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
            } else
            #endif
            {
              __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 324, __pyx_L23_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
              if (__pyx_t_12) {
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_12); __pyx_t_12 = NULL;
              }
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_8genexpr4__pyx_v_asset);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_8genexpr4__pyx_v_asset);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+__pyx_t_7, __pyx_8genexpr4__pyx_v_asset);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_field);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_field);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1+__pyx_t_7, __pyx_v_field);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 2+__pyx_t_7, __pyx_t_15);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 3+__pyx_t_7, __pyx_v_self-&gt;data_frequency);
              __pyx_t_15 = 0;
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 324, __pyx_L23_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
            }
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, (PyObject*)__pyx_8genexpr4__pyx_v_asset, (PyObject*)__pyx_t_8))) <span class='error_goto'>__PYX_ERR(0, 324, __pyx_L23_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">329</span>:                         <span class="p">)</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">330</span>:                         <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span></pre>
<pre class='cython code score-51 '>          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_assets)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_assets)) {
            __pyx_t_5 = __pyx_v_assets; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_10 = 0;
            __pyx_t_11 = NULL;
          } else {
            __pyx_t_10 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_assets);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 330, __pyx_L23_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_11 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 330, __pyx_L23_error)</span>
          }
          for (;;) {
            if (likely(!__pyx_t_11)) {
              if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
                if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 330, __pyx_L23_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 330, __pyx_L23_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              } else {
                if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 330, __pyx_L23_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 330, __pyx_L23_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              }
            } else {
              __pyx_t_8 = __pyx_t_11(__pyx_t_5);
              if (unlikely(!__pyx_t_8)) {
                PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                if (exc_type) {
                  if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                  else <span class='error_goto'>__PYX_ERR(0, 330, __pyx_L23_error)</span>
                }
                break;
              }
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
            }
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr4__pyx_v_asset, __pyx_t_8);
            __pyx_t_8 = 0;
/* … */
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr4__pyx_v_asset); __pyx_8genexpr4__pyx_v_asset = 0;
          goto __pyx_L26_exit_scope;
          __pyx_L23_error:;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr4__pyx_v_asset); __pyx_8genexpr4__pyx_v_asset = 0;
          goto __pyx_L1_error;
          __pyx_L26_exit_scope:;
        } /* exit inner scope */
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_data, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 323, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>:                     <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_index, __pyx_v_assets) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 323, __pyx_L1_error)</span>
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_name_2, __pyx_v_fields) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 323, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">332</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">333</span>:                     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span></pre>
<pre class='cython code score-17 '>      /*else*/ {
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_Series);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        { /* enter inner scope */
          __pyx_t_9 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 333, __pyx_L29_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
/* … */
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_empty_tuple, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 333, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_r = __pyx_t_9;
        __pyx_t_9 = 0;
        goto __pyx_L0;
      }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">334</span>:                         <span class="n">asset</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_adjusted_value</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>            __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_adjusted_value);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 334, __pyx_L29_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
</pre><pre class="cython line score-0">&#xA0;<span class="">335</span>:                             <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>:                             <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">337</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>            __pyx_t_14 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 337, __pyx_L29_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">338</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">(),</span></pre>
<pre class='cython code score-17 '>            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
            __pyx_t_12 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_13 = NULL;
            if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
              __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
              if (likely(__pyx_t_13)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
              }
            }
            __pyx_t_15 = (__pyx_t_13) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_12, __pyx_t_13) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_12);
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
            if (unlikely(!__pyx_t_15)) <span class='error_goto'>__PYX_ERR(0, 338, __pyx_L29_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
</pre><pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">339</span>:                             <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-51 '>            __pyx_t_12 = NULL;
            __pyx_t_7 = 0;
            if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
              __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
              if (likely(__pyx_t_12)) {
                PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
                __pyx_t_7 = 1;
              }
            }
            #if CYTHON_FAST_PYCALL
            if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
              PyObject *__pyx_temp[6] = {__pyx_t_12, __pyx_8genexpr5__pyx_v_asset, __pyx_v_field, __pyx_t_14, __pyx_t_15, __pyx_v_self-&gt;data_frequency};
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 334, __pyx_L29_error)</span>
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
            } else
            #endif
            #if CYTHON_FAST_PYCCALL
            if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
              PyObject *__pyx_temp[6] = {__pyx_t_12, __pyx_8genexpr5__pyx_v_asset, __pyx_v_field, __pyx_t_14, __pyx_t_15, __pyx_v_self-&gt;data_frequency};
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 334, __pyx_L29_error)</span>
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
            } else
            #endif
            {
              __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 334, __pyx_L29_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
              if (__pyx_t_12) {
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_12); __pyx_t_12 = NULL;
              }
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_8genexpr5__pyx_v_asset);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_8genexpr5__pyx_v_asset);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0+__pyx_t_7, __pyx_8genexpr5__pyx_v_asset);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_field);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_field);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1+__pyx_t_7, __pyx_v_field);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 2+__pyx_t_7, __pyx_t_14);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 3+__pyx_t_7, __pyx_t_15);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
              <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 4+__pyx_t_7, __pyx_v_self-&gt;data_frequency);
              __pyx_t_14 = 0;
              __pyx_t_15 = 0;
              __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 334, __pyx_L29_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
            }
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
            if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_9, (PyObject*)__pyx_8genexpr5__pyx_v_asset, (PyObject*)__pyx_t_8))) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L29_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">340</span>:                         <span class="p">)</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>:                         <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span></pre>
<pre class='cython code score-51 '>          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_assets)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_assets)) {
            __pyx_t_5 = __pyx_v_assets; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_10 = 0;
            __pyx_t_11 = NULL;
          } else {
            __pyx_t_10 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_assets);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 341, __pyx_L29_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
            __pyx_t_11 = Py_TYPE(__pyx_t_5)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 341, __pyx_L29_error)</span>
          }
          for (;;) {
            if (likely(!__pyx_t_11)) {
              if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
                if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_5)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_5, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 341, __pyx_L29_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 341, __pyx_L29_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              } else {
                if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_5)) break;
                #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_8 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 341, __pyx_L29_error)</span>
                #else
                __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_5, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 341, __pyx_L29_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
                #endif
              }
            } else {
              __pyx_t_8 = __pyx_t_11(__pyx_t_5);
              if (unlikely(!__pyx_t_8)) {
                PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                if (exc_type) {
                  if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                  else <span class='error_goto'>__PYX_ERR(0, 341, __pyx_L29_error)</span>
                }
                break;
              }
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
            }
            <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr5__pyx_v_asset, __pyx_t_8);
            __pyx_t_8 = 0;
/* … */
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr5__pyx_v_asset); __pyx_8genexpr5__pyx_v_asset = 0;
          goto __pyx_L32_exit_scope;
          __pyx_L29_error:;
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr5__pyx_v_asset); __pyx_8genexpr5__pyx_v_asset = 0;
          goto __pyx_L1_error;
          __pyx_L32_exit_scope:;
        } /* exit inner scope */
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_data, __pyx_t_9) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 333, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">342</span>:                     <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_index, __pyx_v_assets) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 333, __pyx_L1_error)</span>
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_name_2, __pyx_v_fields) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 333, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">343</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">345</span>:                 <span class="c"># both assets and fields are iterable</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">346</span>:                 <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span></pre>
<pre class='cython code score-2 '>    /*else*/ {
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 346, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      __pyx_v_data = ((PyObject*)__pyx_t_9);
      __pyx_t_9 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">347</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">348</span>:                 <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_2 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 348, __pyx_L1_error)</span>
      __pyx_t_3 = ((!__pyx_t_2) != 0);
      if (__pyx_t_3) {
/* … */
        goto __pyx_L33;
      }
</pre><pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">349</span>:                     <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span></pre>
<pre class='cython code score-43 '>        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_fields)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_fields)) {
          __pyx_t_9 = __pyx_v_fields; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_10 = 0;
          __pyx_t_11 = NULL;
        } else {
          __pyx_t_10 = -1; __pyx_t_9 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_fields);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_11 = Py_TYPE(__pyx_t_9)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
        }
        for (;;) {
          if (likely(!__pyx_t_11)) {
            if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_9))) {
              if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_9)) break;
              #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_9, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 349, __pyx_L1_error)</span>
              #else
              __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_9, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
              #endif
            } else {
              if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_9)) break;
              #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_9, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 349, __pyx_L1_error)</span>
              #else
              __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_9, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
              #endif
            }
          } else {
            __pyx_t_1 = __pyx_t_11(__pyx_t_9);
            if (unlikely(!__pyx_t_1)) {
              PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
              if (exc_type) {
                if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                else <span class='error_goto'>__PYX_ERR(0, 349, __pyx_L1_error)</span>
              }
              break;
            }
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          }
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_field, __pyx_t_1);
          __pyx_t_1 = 0;
/* … */
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">350</span>:                         <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span></pre>
<pre class='cython code score-17 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 350, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_Series);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 350, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 350, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          { /* enter inner scope */
            __pyx_t_5 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 350, __pyx_L38_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
/* … */
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_empty_tuple, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 350, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_series, __pyx_t_5);
          __pyx_t_5 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>:                             <span class="n">asset</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_spot_value</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>              __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_spot_value);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 351, __pyx_L38_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
</pre><pre class="cython line score-0">&#xA0;<span class="">352</span>:                                 <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>:                                 <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">354</span>:                                 <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>              __pyx_t_15 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 354, __pyx_L38_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
</pre><pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">355</span>:                                 <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-48 '>              __pyx_t_14 = NULL;
              __pyx_t_7 = 0;
              if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
                __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
                if (likely(__pyx_t_14)) {
                  PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
                  __pyx_t_7 = 1;
                }
              }
              #if CYTHON_FAST_PYCALL
              if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_13)) {
                PyObject *__pyx_temp[5] = {__pyx_t_14, __pyx_8genexpr6__pyx_v_asset, __pyx_v_field, __pyx_t_15, __pyx_v_self-&gt;data_frequency};
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 351, __pyx_L38_error)</span>
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
              } else
              #endif
              #if CYTHON_FAST_PYCCALL
              if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_13)) {
                PyObject *__pyx_temp[5] = {__pyx_t_14, __pyx_8genexpr6__pyx_v_asset, __pyx_v_field, __pyx_t_15, __pyx_v_self-&gt;data_frequency};
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_7, 4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 351, __pyx_L38_error)</span>
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
              } else
              #endif
              {
                __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 351, __pyx_L38_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
                if (__pyx_t_14) {
                  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_14); __pyx_t_14 = NULL;
                }
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_8genexpr6__pyx_v_asset);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_8genexpr6__pyx_v_asset);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0+__pyx_t_7, __pyx_8genexpr6__pyx_v_asset);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_field);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_field);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1+__pyx_t_7, __pyx_v_field);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 2+__pyx_t_7, __pyx_t_15);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 3+__pyx_t_7, __pyx_v_self-&gt;data_frequency);
                __pyx_t_15 = 0;
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 351, __pyx_L38_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
              }
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
              if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, (PyObject*)__pyx_8genexpr6__pyx_v_asset, (PyObject*)__pyx_t_6))) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L38_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">356</span>:                             <span class="p">)</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">357</span>:                             <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span></pre>
<pre class='cython code score-51 '>            if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_assets)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_assets)) {
              __pyx_t_8 = __pyx_v_assets; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_16 = 0;
              __pyx_t_17 = NULL;
            } else {
              __pyx_t_16 = -1; __pyx_t_8 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_assets);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 357, __pyx_L38_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              __pyx_t_17 = Py_TYPE(__pyx_t_8)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 357, __pyx_L38_error)</span>
            }
            for (;;) {
              if (likely(!__pyx_t_17)) {
                if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8))) {
                  if (__pyx_t_16 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_8)) break;
                  #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                  __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_8, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_16++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 357, __pyx_L38_error)</span>
                  #else
                  __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 357, __pyx_L38_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                  #endif
                } else {
                  if (__pyx_t_16 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_8)) break;
                  #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                  __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_8, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_16++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 357, __pyx_L38_error)</span>
                  #else
                  __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 357, __pyx_L38_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                  #endif
                }
              } else {
                __pyx_t_6 = __pyx_t_17(__pyx_t_8);
                if (unlikely(!__pyx_t_6)) {
                  PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                  if (exc_type) {
                    if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                    else <span class='error_goto'>__PYX_ERR(0, 357, __pyx_L38_error)</span>
                  }
                  break;
                }
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
              }
              <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr6__pyx_v_asset, __pyx_t_6);
              __pyx_t_6 = 0;
/* … */
            }
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr6__pyx_v_asset); __pyx_8genexpr6__pyx_v_asset = 0;
            goto __pyx_L41_exit_scope;
            __pyx_L38_error:;
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr6__pyx_v_asset); __pyx_8genexpr6__pyx_v_asset = 0;
            goto __pyx_L1_error;
            __pyx_L41_exit_scope:;
          } /* exit inner scope */
          if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_data, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 350, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">358</span>:                         <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">field</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>          if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_index, __pyx_v_assets) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 350, __pyx_L1_error)</span>
          if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_name_2, __pyx_v_field) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 350, __pyx_L1_error)</span>
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">359</span>:                         <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span></pre>
<pre class='cython code score-5 '>          if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_data, __pyx_v_field, __pyx_v_series) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 359, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">360</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">361</span>:                     <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span></pre>
<pre class='cython code score-43 '>      /*else*/ {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_fields)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_fields)) {
          __pyx_t_9 = __pyx_v_fields; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_10 = 0;
          __pyx_t_11 = NULL;
        } else {
          __pyx_t_10 = -1; __pyx_t_9 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_fields);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 361, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_11 = Py_TYPE(__pyx_t_9)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 361, __pyx_L1_error)</span>
        }
        for (;;) {
          if (likely(!__pyx_t_11)) {
            if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_9))) {
              if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_9)) break;
              #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_9, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 361, __pyx_L1_error)</span>
              #else
              __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_9, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 361, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
              #endif
            } else {
              if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_9)) break;
              #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_9, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 361, __pyx_L1_error)</span>
              #else
              __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_9, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 361, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
              #endif
            }
          } else {
            __pyx_t_5 = __pyx_t_11(__pyx_t_9);
            if (unlikely(!__pyx_t_5)) {
              PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
              if (exc_type) {
                if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                else <span class='error_goto'>__PYX_ERR(0, 361, __pyx_L1_error)</span>
              }
              break;
            }
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          }
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_field, __pyx_t_5);
          __pyx_t_5 = 0;
/* … */
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      }
      __pyx_L33:;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">362</span>:                         <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span></pre>
<pre class='cython code score-17 '>          <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_Series);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          { /* enter inner scope */
            __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 362, __pyx_L46_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
/* … */
          __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_empty_tuple, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_series, __pyx_t_4);
          __pyx_t_4 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">363</span>:                             <span class="n">asset</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_adjusted_value</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>              __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_adjusted_value);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 363, __pyx_L46_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
</pre><pre class="cython line score-0">&#xA0;<span class="">364</span>:                                 <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">365</span>:                                 <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">366</span>:                                 <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>              __pyx_t_12 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 366, __pyx_L46_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">367</span>:                                 <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">(),</span></pre>
<pre class='cython code score-17 '>              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
              __pyx_t_14 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_18 = NULL;
              if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
                __pyx_t_18 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
                if (likely(__pyx_t_18)) {
                  PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_18);
                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
                }
              }
              __pyx_t_15 = (__pyx_t_18) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_14, __pyx_t_18) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_14);
              <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
              if (unlikely(!__pyx_t_15)) <span class='error_goto'>__PYX_ERR(0, 367, __pyx_L46_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
</pre><pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">368</span>:                                 <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-51 '>              __pyx_t_14 = NULL;
              __pyx_t_7 = 0;
              if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
                __pyx_t_14 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
                if (likely(__pyx_t_14)) {
                  PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_14);
                  <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
                  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
                  __pyx_t_7 = 1;
                }
              }
              #if CYTHON_FAST_PYCALL
              if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_13)) {
                PyObject *__pyx_temp[6] = {__pyx_t_14, __pyx_8genexpr7__pyx_v_asset, __pyx_v_field, __pyx_t_12, __pyx_t_15, __pyx_v_self-&gt;data_frequency};
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 363, __pyx_L46_error)</span>
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
              } else
              #endif
              #if CYTHON_FAST_PYCCALL
              if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_13)) {
                PyObject *__pyx_temp[6] = {__pyx_t_14, __pyx_8genexpr7__pyx_v_asset, __pyx_v_field, __pyx_t_12, __pyx_t_15, __pyx_v_self-&gt;data_frequency};
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_7, 5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 363, __pyx_L46_error)</span>
                <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
              } else
              #endif
              {
                __pyx_t_18 = <span class='py_c_api'>PyTuple_New</span>(5+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 363, __pyx_L46_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
                if (__pyx_t_14) {
                  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 0, __pyx_t_14); __pyx_t_14 = NULL;
                }
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_8genexpr7__pyx_v_asset);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_8genexpr7__pyx_v_asset);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 0+__pyx_t_7, __pyx_8genexpr7__pyx_v_asset);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_field);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_field);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 1+__pyx_t_7, __pyx_v_field);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 2+__pyx_t_7, __pyx_t_12);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 3+__pyx_t_7, __pyx_t_15);
                <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
                <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
                <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 4+__pyx_t_7, __pyx_v_self-&gt;data_frequency);
                __pyx_t_12 = 0;
                __pyx_t_15 = 0;
                __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_18, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 363, __pyx_L46_error)</span>
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
              }
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
              if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, (PyObject*)__pyx_8genexpr7__pyx_v_asset, (PyObject*)__pyx_t_6))) <span class='error_goto'>__PYX_ERR(0, 363, __pyx_L46_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">369</span>:                             <span class="p">)</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">370</span>:                             <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span></pre>
<pre class='cython code score-51 '>            if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_assets)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_assets)) {
              __pyx_t_8 = __pyx_v_assets; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_16 = 0;
              __pyx_t_17 = NULL;
            } else {
              __pyx_t_16 = -1; __pyx_t_8 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_assets);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 370, __pyx_L46_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
              __pyx_t_17 = Py_TYPE(__pyx_t_8)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 370, __pyx_L46_error)</span>
            }
            for (;;) {
              if (likely(!__pyx_t_17)) {
                if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8))) {
                  if (__pyx_t_16 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_8)) break;
                  #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                  __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_8, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_16++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L46_error)</span>
                  #else
                  __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 370, __pyx_L46_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                  #endif
                } else {
                  if (__pyx_t_16 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_8)) break;
                  #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
                  __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_8, __pyx_t_16); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_16++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L46_error)</span>
                  #else
                  __pyx_t_6 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_16); __pyx_t_16++;<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 370, __pyx_L46_error)</span>
                  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
                  #endif
                }
              } else {
                __pyx_t_6 = __pyx_t_17(__pyx_t_8);
                if (unlikely(!__pyx_t_6)) {
                  PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
                  if (exc_type) {
                    if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                    else <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L46_error)</span>
                  }
                  break;
                }
                <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
              }
              <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr7__pyx_v_asset, __pyx_t_6);
              __pyx_t_6 = 0;
/* … */
            }
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr7__pyx_v_asset); __pyx_8genexpr7__pyx_v_asset = 0;
            goto __pyx_L49_exit_scope;
            __pyx_L46_error:;
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr7__pyx_v_asset); __pyx_8genexpr7__pyx_v_asset = 0;
            goto __pyx_L1_error;
            __pyx_L49_exit_scope:;
          } /* exit inner scope */
          if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_data, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">371</span>:                         <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">field</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>          if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_index, __pyx_v_assets) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
          if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_name_2, __pyx_v_field) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">372</span>:                         <span class="n">data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span></pre>
<pre class='cython code score-5 '>          if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_data, __pyx_v_field, __pyx_v_series) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 372, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">373</span>: </pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">374</span>:                 <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></pre>
<pre class='cython code score-20 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_DataFrame);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      __pyx_t_9 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_v_data) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_v_data);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 374, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_r = __pyx_t_9;
      __pyx_t_9 = 0;
      goto __pyx_L0;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">375</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">376</span>:     <span class="nd">@check_parameters</span><span class="p">((</span><span class="s">&#39;continuous_future&#39;</span><span class="p">,),</span></pre>
<pre class='cython code score-16 '>  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 376, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__19);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_tuple__19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7zipline_9_protocol_check_parameters), __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 376, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
/* … */
  __pyx_tuple__19 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_u_continuous_future);<span class='error_goto'> if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 376, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__19);
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">377</span>:                       <span class="p">(</span><span class="n">ContinuousFuture</span><span class="p">,))</span></pre>
<pre class='cython code score-8 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_ContinuousFuture);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">378</span>:     <span class="k">def</span> <span class="nf">current_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuous_future</span><span class="p">):</span></pre>
<pre class='cython code score-35 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_5current_chain(PyObject *__pyx_v_self, PyObject *__pyx_v_continuous_future); /*proto*/
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_5current_chain(PyObject *__pyx_v_self, PyObject *__pyx_v_continuous_future) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("current_chain (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_4current_chain(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self), ((PyObject *)__pyx_v_continuous_future));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_4current_chain(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_continuous_future) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("current_chain", 0);
  <span class='trace'>__Pyx_TraceCall</span>("current_chain", __pyx_f[0], 378, 0, <span class='error_goto'>__PYX_ERR(0, 378, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.current_chain", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  <span class='pyx_c_api'>__Pyx_GetNameInClass</span>(__pyx_t_4, (PyObject *)__pyx_ptype_7zipline_9_protocol_BarData, __pyx_n_s_current_chain);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 378, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 376, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>((PyObject *)__pyx_ptype_7zipline_9_protocol_BarData-&gt;tp_dict, __pyx_n_s_current_chain, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 378, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='py_c_api'>PyType_Modified</span>(__pyx_ptype_7zipline_9_protocol_BarData);
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">379</span>:         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_current_future_chain</span><span class="p">(</span></pre>
<pre class='cython code score-3 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_current_future_chain);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
</pre><pre class="cython line score-0">&#xA0;<span class="">380</span>:             <span class="n">continuous_future</span><span class="p">,</span></pre>
<pre class="cython line score-55" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">381</span>:             <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">())</span></pre>
<pre class='cython code score-55 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  __pyx_t_4 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 381, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_continuous_future, __pyx_t_3};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_continuous_future, __pyx_t_3};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 379, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (__pyx_t_4) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_continuous_future);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_continuous_future);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+__pyx_t_6, __pyx_v_continuous_future);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1+__pyx_t_6, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">382</span>: </pre>
<pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">383</span>:     <span class="nd">@check_parameters</span><span class="p">((</span><span class="s">&#39;assets&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="n">Asset</span><span class="p">,))</span></pre>
<pre class='cython code score-23 '>  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__20);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__20);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_tuple__20);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7zipline_9_protocol_check_parameters), __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
/* … */
  __pyx_tuple__20 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_u_assets);<span class='error_goto'> if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__20);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__20);
</pre><pre class="cython line score-38" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">384</span>:     <span class="k">def</span> <span class="nf">can_trade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span></pre>
<pre class='cython code score-38 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_7can_trade(PyObject *__pyx_v_self, PyObject *__pyx_v_assets); /*proto*/
static char __pyx_doc_7zipline_9_protocol_7BarData_6can_trade[] = "\n        For the given asset or iterable of assets, returns True if all of the\n        following are true:\n\n        1. The asset is alive for the session of the current simulation time\n           (if current simulation time is not a market minute, we use the next\n           session).\n        2. The asset's exchange is open at the current simulation time or at\n           the simulation calendar's next market minute.\n        3. There is a known last price for the asset.\n\n        Parameters\n        ----------\n        assets: zipline.assets.Asset or iterable of zipline.assets.Asset\n            Asset(s) for which tradability should be determined.\n\n        Notes\n        -----\n        The second condition above warrants some further explanation:\n\n        - If the asset's exchange calendar is identical to the simulation\n          calendar, then this condition always returns True.\n        - If there are market minutes in the simulation calendar outside of\n          this asset's exchange's trading hours (for example, if the simulation\n          is running on the CMES calendar but the asset is MSFT, which trades\n          on the NYSE), during those minutes, this condition will return False\n          (for example, 3:15 am Eastern on a weekday, during which the CMES is\n          open but the NYSE is closed).\n\n        Returns\n        -------\n        can_trade : bool or pd.Series[bool]\n            Bool or series of bools indicating whether the requested asset(s)\n            can be traded in the current minute.\n        ";
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_7can_trade(PyObject *__pyx_v_self, PyObject *__pyx_v_assets) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("can_trade (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_6can_trade(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self), ((PyObject *)__pyx_v_assets));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_6can_trade(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_assets) {
  PyObject *__pyx_v_dt = NULL;
  PyObject *__pyx_v_adjusted_dt = NULL;
  PyObject *__pyx_v_data_portal = NULL;
  PyObject *__pyx_v_tradeable = NULL;
  PyObject *__pyx_8genexpr8__pyx_v_asset = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("can_trade", 0);
  <span class='trace'>__Pyx_TraceCall</span>("can_trade", __pyx_f[0], 384, 0, <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.can_trade", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dt);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_adjusted_dt);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_data_portal);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tradeable);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr8__pyx_v_asset);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  <span class='pyx_c_api'>__Pyx_GetNameInClass</span>(__pyx_t_4, (PyObject *)__pyx_ptype_7zipline_9_protocol_BarData, __pyx_n_s_can_trade);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 383, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>((PyObject *)__pyx_ptype_7zipline_9_protocol_BarData-&gt;tp_dict, __pyx_n_s_can_trade, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='py_c_api'>PyType_Modified</span>(__pyx_ptype_7zipline_9_protocol_BarData);
</pre><pre class="cython line score-0">&#xA0;<span class="">385</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">386</span>: <span class="sd">        For the given asset or iterable of assets, returns True if all of the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">387</span>: <span class="sd">        following are true:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">388</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">389</span>: <span class="sd">        1. The asset is alive for the session of the current simulation time</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">390</span>: <span class="sd">           (if current simulation time is not a market minute, we use the next</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">391</span>: <span class="sd">           session).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">392</span>: <span class="sd">        2. The asset&#39;s exchange is open at the current simulation time or at</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">393</span>: <span class="sd">           the simulation calendar&#39;s next market minute.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">394</span>: <span class="sd">        3. There is a known last price for the asset.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">395</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">396</span>: <span class="sd">        Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">397</span>: <span class="sd">        ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">398</span>: <span class="sd">        assets: zipline.assets.Asset or iterable of zipline.assets.Asset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">399</span>: <span class="sd">            Asset(s) for which tradability should be determined.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">400</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">401</span>: <span class="sd">        Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">402</span>: <span class="sd">        -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">403</span>: <span class="sd">        The second condition above warrants some further explanation:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">404</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">405</span>: <span class="sd">        - If the asset&#39;s exchange calendar is identical to the simulation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">406</span>: <span class="sd">          calendar, then this condition always returns True.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">407</span>: <span class="sd">        - If there are market minutes in the simulation calendar outside of</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">408</span>: <span class="sd">          this asset&#39;s exchange&#39;s trading hours (for example, if the simulation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">409</span>: <span class="sd">          is running on the CMES calendar but the asset is MSFT, which trades</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>: <span class="sd">          on the NYSE), during those minutes, this condition will return False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">411</span>: <span class="sd">          (for example, 3:15 am Eastern on a weekday, during which the CMES is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>: <span class="sd">          open but the NYSE is closed).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">413</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">414</span>: <span class="sd">        Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>: <span class="sd">        -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>: <span class="sd">        can_trade : bool or pd.Series[bool]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>: <span class="sd">            Bool or series of bools indicating whether the requested asset(s)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">418</span>: <span class="sd">            can be traded in the current minute.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">419</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">420</span>:         <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">()</span></pre>
<pre class='cython code score-17 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  __pyx_t_2 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dt = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">421</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">422</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 422, __pyx_L1_error)</span>
  if (__pyx_t_4) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">423</span>:             <span class="n">adjusted_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 423, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_v_adjusted_dt = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">424</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">425</span>:             <span class="n">adjusted_dt</span> <span class="o">=</span> <span class="n">dt</span></pre>
<pre class='cython code score-1 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dt);
    __pyx_v_adjusted_dt = __pyx_v_dt;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">426</span>: </pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">427</span>:         <span class="n">data_portal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span></pre>
<pre class='cython code score-1 '>  __pyx_t_1 = __pyx_v_self-&gt;data_portal;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_v_data_portal = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">428</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">429</span>:         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">Asset</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_TypeCheck</span>(__pyx_v_assets, __pyx_ptype_7zipline_6assets_7_assets_Asset); 
  __pyx_t_5 = (__pyx_t_4 != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">430</span>:             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_trade_for_asset</span><span class="p">(</span></pre>
<pre class='cython code score-1 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
/* … */
    __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_can_trade_for_asset(__pyx_v_self, __pyx_v_assets, __pyx_v_dt, __pyx_v_adjusted_dt, __pyx_v_data_portal));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 430, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">431</span>:                 <span class="n">assets</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span> <span class="n">data_portal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">432</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">433</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">434</span>:             <span class="n">tradeable</span> <span class="o">=</span> <span class="p">[</span></pre>
<pre class='cython code score-5 '>  /*else*/ {
    { /* enter inner scope */
      __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 434, __pyx_L7_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">435</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">_can_trade_for_asset</span><span class="p">(</span></pre>
<pre class='cython code score-3 '>        __pyx_t_3 = ((PyObject *)((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_can_trade_for_asset(__pyx_v_self, __pyx_8genexpr8__pyx_v_asset, __pyx_v_dt, __pyx_v_adjusted_dt, __pyx_v_data_portal));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 435, __pyx_L7_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_1, (PyObject*)__pyx_t_3))) <span class='error_goto'>__PYX_ERR(0, 434, __pyx_L7_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">436</span>:                     <span class="n">asset</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span> <span class="n">data_portal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">437</span>:                 <span class="p">)</span></pre>
<pre class="cython line score-45" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>:                 <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span></pre>
<pre class='cython code score-45 '>      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_assets)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_assets)) {
        __pyx_t_2 = __pyx_v_assets; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_6 = 0;
        __pyx_t_7 = NULL;
      } else {
        __pyx_t_6 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_assets);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 438, __pyx_L7_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_7 = Py_TYPE(__pyx_t_2)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 438, __pyx_L7_error)</span>
      }
      for (;;) {
        if (likely(!__pyx_t_7)) {
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
            if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L7_error)</span>
            #else
            __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 438, __pyx_L7_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            #endif
          } else {
            if (__pyx_t_6 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_6); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_6++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L7_error)</span>
            #else
            __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_6); __pyx_t_6++;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 438, __pyx_L7_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            #endif
          }
        } else {
          __pyx_t_3 = __pyx_t_7(__pyx_t_2);
          if (unlikely(!__pyx_t_3)) {
            PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
            if (exc_type) {
              if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
              else <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L7_error)</span>
            }
            break;
          }
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        }
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr8__pyx_v_asset, __pyx_t_3);
        __pyx_t_3 = 0;
/* … */
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr8__pyx_v_asset); __pyx_8genexpr8__pyx_v_asset = 0;
      goto __pyx_L10_exit_scope;
      __pyx_L7_error:;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr8__pyx_v_asset); __pyx_8genexpr8__pyx_v_asset = 0;
      goto __pyx_L1_error;
      __pyx_L10_exit_scope:;
    } /* exit inner scope */
    __pyx_v_tradeable = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">439</span>:             <span class="p">]</span></pre>
<pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">440</span>:             <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tradeable</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span></pre>
<pre class='cython code score-27 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 440, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_Series);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 440, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 440, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_data, __pyx_v_tradeable) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 440, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_index, __pyx_v_assets) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 440, __pyx_L1_error)</span>
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, ((PyObject *)__pyx_ptype_7cpython_4bool_bool)) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 440, __pyx_L1_error)</span>
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 440, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">441</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">442</span>:     <span class="k">cdef</span> <span class="kt">bool</span> <span class="nf">_can_trade_for_asset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span> <span class="n">data_portal</span><span class="p">):</span></pre>
<pre class='cython code score-10 '>static PyBoolObject *__pyx_f_7zipline_9_protocol_7BarData__can_trade_for_asset(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_asset, PyObject *__pyx_v_dt, PyObject *__pyx_v_adjusted_dt, PyObject *__pyx_v_data_portal) {
  PyObject *__pyx_v_session_label = 0;
  PyObject *__pyx_v_dt_to_use_for_exchange_check = 0;
  PyBoolObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_can_trade_for_asset", 0);
  <span class='trace'>__Pyx_TraceCall</span>("_can_trade_for_asset", __pyx_f[0], 442, 0, <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData._can_trade_for_asset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_session_label);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dt_to_use_for_exchange_check);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">443</span>:         <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">session_label</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">444</span>:         <span class="k">cdef</span> <span class="kt">object</span> <span class="nf">dt_to_use_for_exchange_check</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">445</span>: </pre>
<pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_restricted</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">):</span></pre>
<pre class='cython code score-41 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;_is_restricted);
  __pyx_t_2 = __pyx_v_self-&gt;_is_restricted; __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_asset, __pyx_v_adjusted_dt};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 446, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_asset, __pyx_v_adjusted_dt};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 446, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 446, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+__pyx_t_4, __pyx_v_asset);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_adjusted_dt);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_adjusted_dt);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1+__pyx_t_4, __pyx_v_adjusted_dt);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 446, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 446, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">447</span>:             <span class="k">return</span> <span class="bp">False</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_False);
    __pyx_r = ((PyBoolObject *)Py_False);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">448</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">449</span>:         <span class="n">session_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trading_calendar</span><span class="o">.</span><span class="n">minute_to_session_label</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></pre>
<pre class='cython code score-16 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;_trading_calendar, __pyx_n_s_minute_to_session_label);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 449, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_v_dt) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_v_dt);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 449, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_session_label = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">450</span>: </pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">451</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="n">asset</span><span class="o">.</span><span class="n">is_alive_for_session</span><span class="p">(</span><span class="n">session_label</span><span class="p">):</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_asset, __pyx_n_s_is_alive_for_session);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 451, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_v_session_label) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_v_session_label);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 451, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 451, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_7 = ((!__pyx_t_6) != 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">452</span>:             <span class="c"># asset isn&#39;t alive</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">453</span>:             <span class="k">return</span> <span class="bp">False</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_False);
    __pyx_r = ((PyBoolObject *)Py_False);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">454</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>:         <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">auto_close_date</span> <span class="ow">and</span> <span class="n">session_label</span> <span class="o">&gt;</span> <span class="n">asset</span><span class="o">.</span><span class="n">auto_close_date</span><span class="p">:</span></pre>
<pre class='cython code score-16 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_asset, __pyx_n_s_auto_close_date);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 455, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 455, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {
  } else {
    __pyx_t_7 = __pyx_t_6;
    goto __pyx_L6_bool_binop_done;
  }
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_asset, __pyx_n_s_auto_close_date);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 455, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_session_label, __pyx_t_1, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 455, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_7 = __pyx_t_6;
  __pyx_L6_bool_binop_done:;
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">456</span>:             <span class="k">return</span> <span class="bp">False</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_False);
    __pyx_r = ((PyBoolObject *)Py_False);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">457</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">458</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_daily_mode</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_daily_mode)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 458, __pyx_L1_error)</span>
  __pyx_t_6 = ((!__pyx_t_7) != 0);
  if (__pyx_t_6) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">459</span>:             <span class="c"># Find the next market minute for this calendar, and check if this</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">460</span>:             <span class="c"># asset&#39;s exchange is open at that minute.</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">461</span>:             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trading_calendar</span><span class="o">.</span><span class="n">is_open_on_minute</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span></pre>
<pre class='cython code score-19 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;_trading_calendar, __pyx_n_s_is_open_on_minute);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_v_dt) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_v_dt);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_6) {
/* … */
      goto __pyx_L9;
    }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">462</span>:                 <span class="n">dt_to_use_for_exchange_check</span> <span class="o">=</span> <span class="n">dt</span></pre>
<pre class='cython code score-1 '>      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dt);
      __pyx_v_dt_to_use_for_exchange_check = __pyx_v_dt;
</pre><pre class="cython line score-0">&#xA0;<span class="">463</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">464</span>:                 <span class="n">dt_to_use_for_exchange_check</span> <span class="o">=</span> <span class="w">\</span></pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">465</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">_trading_calendar</span><span class="o">.</span><span class="n">next_open</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></pre>
<pre class='cython code score-16 '>    /*else*/ {
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;_trading_calendar, __pyx_n_s_next_open);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_5 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
        __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
        if (likely(__pyx_t_5)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
        }
      }
      __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_v_dt) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_v_dt);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 465, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_dt_to_use_for_exchange_check = __pyx_t_2;
      __pyx_t_2 = 0;
    }
    __pyx_L9:;
</pre><pre class="cython line score-0">&#xA0;<span class="">466</span>: </pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">467</span>:             <span class="k">if</span> <span class="ow">not</span> <span class="n">asset</span><span class="o">.</span><span class="n">is_exchange_open</span><span class="p">(</span><span class="n">dt_to_use_for_exchange_check</span><span class="p">):</span></pre>
<pre class='cython code score-19 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_asset, __pyx_n_s_is_exchange_open);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 467, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      }
    }
    __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_v_dt_to_use_for_exchange_check) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_v_dt_to_use_for_exchange_check);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 467, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 467, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_7 = ((!__pyx_t_6) != 0);
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">468</span>:                 <span class="k">return</span> <span class="bp">False</span></pre>
<pre class='cython code score-2 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_False);
      __pyx_r = ((PyBoolObject *)Py_False);
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">469</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">470</span>:         <span class="c"># is there a last price?</span></pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">471</span>:         <span class="k">return</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span></pre>
<pre class='cython code score-13 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 471, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_isnan);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 471, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 471, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>((!__pyx_t_7));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 471, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_7cpython_4bool_bool)))) <span class='error_goto'>__PYX_ERR(0, 471, __pyx_L1_error)</span>
  __pyx_r = ((PyBoolObject *)__pyx_t_2);
  __pyx_t_2 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">472</span>:             <span class="n">data_portal</span><span class="o">.</span><span class="n">get_spot_value</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_data_portal, __pyx_n_s_get_spot_value);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 472, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
</pre><pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">473</span>:                 <span class="n">asset</span><span class="p">,</span> <span class="s">&quot;price&quot;</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-56 '>  __pyx_t_8 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[5] = {__pyx_t_8, __pyx_v_asset, __pyx_n_u_price, __pyx_v_adjusted_dt, __pyx_v_self-&gt;data_frequency};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_4, 4+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 472, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
    PyObject *__pyx_temp[5] = {__pyx_t_8, __pyx_v_asset, __pyx_n_u_price, __pyx_v_adjusted_dt, __pyx_v_self-&gt;data_frequency};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_4, 4+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 472, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 472, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (__pyx_t_8) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_4, __pyx_v_asset);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_price);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_price);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_4, __pyx_n_u_price);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_adjusted_dt);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_adjusted_dt);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 2+__pyx_t_4, __pyx_v_adjusted_dt);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 3+__pyx_t_4, __pyx_v_self-&gt;data_frequency);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 472, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_3, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 471, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">474</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">475</span>:         <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">476</span>: </pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">477</span>:     <span class="nd">@check_parameters</span><span class="p">((</span><span class="s">&#39;assets&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="n">Asset</span><span class="p">,))</span></pre>
<pre class='cython code score-18 '>  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__20);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__20);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_tuple__20);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7zipline_9_protocol_check_parameters), __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">478</span>:     <span class="k">def</span> <span class="nf">is_stale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">):</span></pre>
<pre class='cython code score-39 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_9is_stale(PyObject *__pyx_v_self, PyObject *__pyx_v_assets); /*proto*/
static char __pyx_doc_7zipline_9_protocol_7BarData_8is_stale[] = "\n        For the given asset or iterable of assets, returns True if the asset\n        is alive and there is no trade data for the current simulation time.\n\n        If the asset has never traded, returns False.\n\n        If the current simulation time is not a valid market time, we use the\n        current time to check if the asset is alive, but we use the last\n        market minute/day for the trade data check.\n\n        Parameters\n        ----------\n        assets: zipline.assets.Asset or iterable of zipline.assets.Asset\n            Asset(s) for which staleness should be determined.\n\n        Returns\n        -------\n        is_stale : bool or pd.Series[bool]\n            Bool or series of bools indicating whether the requested asset(s)\n            are stale.\n        ";
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_9is_stale(PyObject *__pyx_v_self, PyObject *__pyx_v_assets) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("is_stale (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_8is_stale(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self), ((PyObject *)__pyx_v_assets));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_8is_stale(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_assets) {
  PyObject *__pyx_v_dt = NULL;
  PyObject *__pyx_v_adjusted_dt = NULL;
  PyObject *__pyx_v_data_portal = NULL;
  PyObject *__pyx_8genexpr9__pyx_v_asset = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("is_stale", 0);
  <span class='trace'>__Pyx_TraceCall</span>("is_stale", __pyx_f[0], 478, 0, <span class='error_goto'>__PYX_ERR(0, 478, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.is_stale", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dt);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_adjusted_dt);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_data_portal);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr9__pyx_v_asset);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  <span class='pyx_c_api'>__Pyx_GetNameInClass</span>(__pyx_t_4, (PyObject *)__pyx_ptype_7zipline_9_protocol_BarData, __pyx_n_s_is_stale);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>((PyObject *)__pyx_ptype_7zipline_9_protocol_BarData-&gt;tp_dict, __pyx_n_s_is_stale, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 478, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='py_c_api'>PyType_Modified</span>(__pyx_ptype_7zipline_9_protocol_BarData);
</pre><pre class="cython line score-0">&#xA0;<span class="">479</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">480</span>: <span class="sd">        For the given asset or iterable of assets, returns True if the asset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">481</span>: <span class="sd">        is alive and there is no trade data for the current simulation time.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">482</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">483</span>: <span class="sd">        If the asset has never traded, returns False.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">484</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">485</span>: <span class="sd">        If the current simulation time is not a valid market time, we use the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">486</span>: <span class="sd">        current time to check if the asset is alive, but we use the last</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">487</span>: <span class="sd">        market minute/day for the trade data check.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">488</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">489</span>: <span class="sd">        Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">490</span>: <span class="sd">        ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">491</span>: <span class="sd">        assets: zipline.assets.Asset or iterable of zipline.assets.Asset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">492</span>: <span class="sd">            Asset(s) for which staleness should be determined.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">493</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">494</span>: <span class="sd">        Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">495</span>: <span class="sd">        -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">496</span>: <span class="sd">        is_stale : bool or pd.Series[bool]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">497</span>: <span class="sd">            Bool or series of bools indicating whether the requested asset(s)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">498</span>: <span class="sd">            are stale.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">499</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">500</span>:         <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">()</span></pre>
<pre class='cython code score-17 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  __pyx_t_2 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 500, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_dt = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>
  if (__pyx_t_4) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">502</span>:             <span class="n">adjusted_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_v_adjusted_dt = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">503</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">504</span>:             <span class="n">adjusted_dt</span> <span class="o">=</span> <span class="n">dt</span></pre>
<pre class='cython code score-1 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dt);
    __pyx_v_adjusted_dt = __pyx_v_dt;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">505</span>: </pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">506</span>:         <span class="n">data_portal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span></pre>
<pre class='cython code score-1 '>  __pyx_t_1 = __pyx_v_self-&gt;data_portal;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_v_data_portal = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">507</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">508</span>:         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">Asset</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_TypeCheck</span>(__pyx_v_assets, __pyx_ptype_7zipline_6assets_7_assets_Asset); 
  __pyx_t_5 = (__pyx_t_4 != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">509</span>:             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_stale_for_asset</span><span class="p">(</span></pre>
<pre class='cython code score-1 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
/* … */
    __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_is_stale_for_asset(__pyx_v_self, __pyx_v_assets, __pyx_v_dt, __pyx_v_adjusted_dt, __pyx_v_data_portal));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">510</span>:                 <span class="n">assets</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span> <span class="n">data_portal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">511</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">512</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">513</span>:             <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span></pre>
<pre class='cython code score-17 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 513, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_Series);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 513, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 513, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    { /* enter inner scope */
      __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 513, __pyx_L7_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
/* … */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 513, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">514</span>:                 <span class="n">asset</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_stale_for_asset</span><span class="p">(</span></pre>
<pre class='cython code score-6 '>        __pyx_t_9 = ((PyObject *)((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_is_stale_for_asset(__pyx_v_self, __pyx_8genexpr9__pyx_v_asset, __pyx_v_dt, __pyx_v_adjusted_dt, __pyx_v_data_portal));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 514, __pyx_L7_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, (PyObject*)__pyx_8genexpr9__pyx_v_asset, (PyObject*)__pyx_t_9))) <span class='error_goto'>__PYX_ERR(0, 514, __pyx_L7_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">515</span>:                     <span class="n">asset</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span> <span class="n">data_portal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">516</span>:                 <span class="p">)</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">517</span>:                 <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span></pre>
<pre class='cython code score-51 '>      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_assets)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_assets)) {
        __pyx_t_6 = __pyx_v_assets; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6); __pyx_t_7 = 0;
        __pyx_t_8 = NULL;
      } else {
        __pyx_t_7 = -1; __pyx_t_6 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_assets);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 517, __pyx_L7_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_8 = Py_TYPE(__pyx_t_6)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 517, __pyx_L7_error)</span>
      }
      for (;;) {
        if (likely(!__pyx_t_8)) {
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_6))) {
            if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_6)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_9 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_6, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 517, __pyx_L7_error)</span>
            #else
            __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_6, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 517, __pyx_L7_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
            #endif
          } else {
            if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_6)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_9 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_6, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 517, __pyx_L7_error)</span>
            #else
            __pyx_t_9 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_6, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 517, __pyx_L7_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
            #endif
          }
        } else {
          __pyx_t_9 = __pyx_t_8(__pyx_t_6);
          if (unlikely(!__pyx_t_9)) {
            PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
            if (exc_type) {
              if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
              else <span class='error_goto'>__PYX_ERR(0, 517, __pyx_L7_error)</span>
            }
            break;
          }
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        }
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_8genexpr9__pyx_v_asset, __pyx_t_9);
        __pyx_t_9 = 0;
/* … */
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr9__pyx_v_asset); __pyx_8genexpr9__pyx_v_asset = 0;
      goto __pyx_L10_exit_scope;
      __pyx_L7_error:;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_8genexpr9__pyx_v_asset); __pyx_8genexpr9__pyx_v_asset = 0;
      goto __pyx_L1_error;
      __pyx_L10_exit_scope:;
    } /* exit inner scope */
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_data, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 513, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">518</span>:             <span class="p">})</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">519</span>: </pre>
<pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">520</span>:     <span class="k">cdef</span> <span class="kt">bool</span> <span class="nf">_is_stale_for_asset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span> <span class="n">data_portal</span><span class="p">):</span></pre>
<pre class='cython code score-9 '>static PyBoolObject *__pyx_f_7zipline_9_protocol_7BarData__is_stale_for_asset(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_asset, PyObject *__pyx_v_dt, PyObject *__pyx_v_adjusted_dt, PyObject *__pyx_v_data_portal) {
  PyObject *__pyx_v_session_label = NULL;
  PyObject *__pyx_v_current_volume = NULL;
  PyObject *__pyx_v_last_traded_dt = NULL;
  PyBoolObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_is_stale_for_asset", 0);
  <span class='trace'>__Pyx_TraceCall</span>("_is_stale_for_asset", __pyx_f[0], 520, 0, <span class='error_goto'>__PYX_ERR(0, 520, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData._is_stale_for_asset", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_session_label);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_current_volume);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_last_traded_dt);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">521</span>:         <span class="n">session_label</span> <span class="o">=</span> <span class="n">normalize_date</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>  <span class="c"># FIXME</span></pre>
<pre class='cython code score-16 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_normalize_date);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_dt) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_v_dt);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 521, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_session_label = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">522</span>: </pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">523</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="n">asset</span><span class="o">.</span><span class="n">is_alive_for_session</span><span class="p">(</span><span class="n">session_label</span><span class="p">):</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_asset, __pyx_n_s_is_alive_for_session);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_session_label) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_v_session_label);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = ((!__pyx_t_4) != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">524</span>:             <span class="k">return</span> <span class="bp">False</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_False);
    __pyx_r = ((PyBoolObject *)Py_False);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">525</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">526</span>:         <span class="n">current_volume</span> <span class="o">=</span> <span class="n">data_portal</span><span class="o">.</span><span class="n">get_spot_value</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_data_portal, __pyx_n_s_get_spot_value);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 526, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
</pre><pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">527</span>:             <span class="n">asset</span><span class="p">,</span> <span class="s">&quot;volume&quot;</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span></pre>
<pre class='cython code score-41 '>  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[5] = {__pyx_t_3, __pyx_v_asset, __pyx_n_u_volume, __pyx_v_adjusted_dt, __pyx_v_self-&gt;data_frequency};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[5] = {__pyx_t_3, __pyx_v_asset, __pyx_n_u_volume, __pyx_v_adjusted_dt, __pyx_v_self-&gt;data_frequency};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 526, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+__pyx_t_6, __pyx_v_asset);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_volume);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_volume);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1+__pyx_t_6, __pyx_n_u_volume);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_adjusted_dt);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_adjusted_dt);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 2+__pyx_t_6, __pyx_v_adjusted_dt);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 3+__pyx_t_6, __pyx_v_self-&gt;data_frequency);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_current_volume = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">528</span>:         <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">529</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">530</span>:         <span class="k">if</span> <span class="n">current_volume</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_current_volume, __pyx_int_0, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 530, __pyx_L1_error)</span>
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 530, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">531</span>:             <span class="c"># found a current value, so we know this asset is not stale.</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">532</span>:             <span class="k">return</span> <span class="bp">False</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_False);
    __pyx_r = ((PyBoolObject *)Py_False);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">533</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">534</span>:             <span class="c"># we need to distinguish between if this asset has ever traded</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">535</span>:             <span class="c"># (stale = True) or has never traded (stale = False)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">536</span>:             <span class="n">last_traded_dt</span> <span class="o">=</span> <span class="w">\</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">537</span>:                 <span class="n">data_portal</span><span class="o">.</span><span class="n">get_spot_value</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="s">&quot;last_traded&quot;</span><span class="p">,</span> <span class="n">adjusted_dt</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_data_portal, __pyx_n_s_get_spot_value);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
</pre><pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>:                                            <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span><span class="p">)</span></pre>
<pre class='cython code score-41 '>    __pyx_t_7 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_7)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_v_asset, __pyx_n_u_last_traded, __pyx_v_adjusted_dt, __pyx_v_self-&gt;data_frequency};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[5] = {__pyx_t_7, __pyx_v_asset, __pyx_n_u_last_traded, __pyx_v_adjusted_dt, __pyx_v_self-&gt;data_frequency};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    } else
    #endif
    {
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 537, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      if (__pyx_t_7) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_7); __pyx_t_7 = NULL;
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+__pyx_t_6, __pyx_v_asset);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_last_traded);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_last_traded);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1+__pyx_t_6, __pyx_n_u_last_traded);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_adjusted_dt);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_adjusted_dt);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2+__pyx_t_6, __pyx_v_adjusted_dt);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 3+__pyx_t_6, __pyx_v_self-&gt;data_frequency);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_last_traded_dt = __pyx_t_1;
    __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">539</span>: </pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">540</span>:             <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">last_traded_dt</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span></pre>
<pre class='cython code score-11 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_NaT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = (__pyx_v_last_traded_dt != __pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 540, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (!(likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_7cpython_4bool_bool)))) <span class='error_goto'>__PYX_ERR(0, 540, __pyx_L1_error)</span>
    __pyx_r = ((PyBoolObject *)__pyx_t_2);
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">541</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">542</span>:     <span class="nd">@check_parameters</span><span class="p">((</span><span class="s">&#39;assets&#39;</span><span class="p">,</span> <span class="s">&#39;fields&#39;</span><span class="p">,</span> <span class="s">&#39;bar_count&#39;</span><span class="p">,</span> <span class="s">&#39;frequency&#39;</span><span class="p">),</span></pre>
<pre class='cython code score-16 '>  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 542, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__21);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__21);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_tuple__21);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7zipline_9_protocol_check_parameters), __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 542, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* … */
  __pyx_tuple__21 = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_n_u_assets, __pyx_n_u_fields, __pyx_n_u_bar_count, __pyx_n_u_frequency);<span class='error_goto'> if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 542, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__21);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__21);
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>:                       <span class="p">((</span><span class="n">Asset</span><span class="p">,</span> <span class="n">ContinuousFuture</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span></pre>
<pre class='cython code score-22 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_ContinuousFuture);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 543, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 543, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_ptype_7zipline_6assets_7_assets_Asset));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, ((PyObject *)(&amp;PyUnicode_Type)));
  __pyx_t_1 = 0;
/* … */
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 543, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)(&amp;PyInt_Type)));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)(&amp;PyInt_Type)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, ((PyObject *)(&amp;PyInt_Type)));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 3, __pyx_t_2);
  __pyx_t_4 = 0;
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">544</span>:                        <span class="p">(</span><span class="nb">str</span><span class="p">,),</span></pre>
<pre class='cython code score-7 '>  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)(&amp;PyUnicode_Type)));
</pre><pre class="cython line score-0">&#xA0;<span class="">545</span>:                        <span class="nb">int</span><span class="p">,</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">546</span>:                        <span class="p">(</span><span class="nb">str</span><span class="p">,)))</span></pre>
<pre class='cython code score-7 '>  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 546, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)(&amp;PyUnicode_Type)));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)(&amp;PyUnicode_Type)));
</pre><pre class="cython line score-83" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">547</span>:     <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assets</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">bar_count</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span></pre>
<pre class='cython code score-83 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_11history(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7zipline_9_protocol_7BarData_10history[] = "\n        Returns a trailing window of length ``bar_count`` with data for\n        the given assets, fields, and frequency, adjusted for splits, dividends,\n        and mergers as of the current simulation time.\n\n        The semantics for missing data are identical to the ones described in\n        the notes for :meth:`current`.\n\n        Parameters\n        ----------\n        assets: zipline.assets.Asset or iterable of zipline.assets.Asset\n            The asset(s) for which data is requested.\n        fields: string or iterable of string.\n            Requested data field(s). Valid field names are: \"price\",\n            \"last_traded\", \"open\", \"high\", \"low\", \"close\", and \"volume\".\n        bar_count: int\n            Number of data observations requested.\n        frequency: str\n            String indicating whether to load daily or minutely data\n            observations. Pass '1m' for minutely data, '1d' for daily data.\n\n        Returns\n        -------\n        history : pd.Series or pd.DataFrame or pd.Panel\n            See notes below.\n\n        Notes\n        -----\n        The return type of this function depends on the types of ``assets`` and\n        ``fields``:\n\n        - If a single asset and a single field are requested, the returned\n          value is a :class:`pd.Series` of length ``bar_count`` whose index is\n          :class:`pd.DatetimeIndex`.\n\n        - If a single asset and multiple fields are requested, the returned\n          value is a :class:`pd.DataFrame` with shape\n          ``(bar_count, len(fields))``. The frame's index will be a\n          :class:`pd.DatetimeIndex`, and its columns will be ``fields``.\n\n        - If multiple assets and a single field are requested, the returned\n          value is a :class:`pd.DataFrame` with shape\n          ``(bar_count, len(assets))``. The frame's index will be a\n          :class:`pd.DatetimeIndex`, and its columns will be ``assets``.\n\n        - If multiple assets and m""ultiple fields are requested, the returned\n          value is a :class:`pd.DataFrame` with a pd.MultiIndex containing pairs of\n           :class:`pd.DatetimeIndex`, and ``assets``, while the columns while contain the field(s).\n           It has shape``(bar_count * len(assets), len(fields))``. The names of the pd.MultiIndex are\n            - ``date`` if frequency == '1d'`` or ``date_time`` if frequency == '1m``, and\n            - ``asset``\n\n        If the current simulation time is not a valid market time, we use the last market close instead.\n        ";
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_11history(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_assets = 0;
  PyObject *__pyx_v_fields = 0;
  PyObject *__pyx_v_bar_count = 0;
  PyObject *__pyx_v_frequency = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("history (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_assets,&amp;__pyx_n_s_fields,&amp;__pyx_n_s_bar_count,&amp;__pyx_n_s_frequency,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_assets)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_fields)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("history", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bar_count)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("history", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_frequency)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("history", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "history") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_assets = values[0];
    __pyx_v_fields = values[1];
    __pyx_v_bar_count = values[2];
    __pyx_v_frequency = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("history", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.history", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_10history(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self), __pyx_v_assets, __pyx_v_fields, __pyx_v_bar_count, __pyx_v_frequency);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_10history(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_assets, PyObject *__pyx_v_fields, PyObject *__pyx_v_bar_count, PyObject *__pyx_v_frequency) {
  int __pyx_v_single_field;
  int __pyx_v_single_asset;
  PyObject *__pyx_v_asset_list = NULL;
  PyObject *__pyx_v_df = NULL;
  PyObject *__pyx_v_adjs = NULL;
  PyObject *__pyx_v_df_dict = NULL;
  PyObject *__pyx_v_dt_label = NULL;
  PyObject *__pyx_9genexpr10__pyx_v_field = NULL;
  PyObject *__pyx_9genexpr11__pyx_v_field = NULL;
  PyObject *__pyx_9genexpr12__pyx_v_field = NULL;
  PyObject *__pyx_9genexpr12__pyx_v_df = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("history", 0);
  <span class='trace'>__Pyx_TraceCall</span>("history", __pyx_f[0], 547, 0, <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.history", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_asset_list);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_df);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_adjs);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_df_dict);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dt_label);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr10__pyx_v_field);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr11__pyx_v_field);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr12__pyx_v_field);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr12__pyx_v_df);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  <span class='pyx_c_api'>__Pyx_GetNameInClass</span>(__pyx_t_2, (PyObject *)__pyx_ptype_7zipline_9_protocol_BarData, __pyx_n_s_history);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 542, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>((PyObject *)__pyx_ptype_7zipline_9_protocol_BarData-&gt;tp_dict, __pyx_n_s_history, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='py_c_api'>PyType_Modified</span>(__pyx_ptype_7zipline_9_protocol_BarData);
</pre><pre class="cython line score-0">&#xA0;<span class="">548</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">549</span>: <span class="sd">        Returns a trailing window of length ``bar_count`` with data for</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">550</span>: <span class="sd">        the given assets, fields, and frequency, adjusted for splits, dividends,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">551</span>: <span class="sd">        and mergers as of the current simulation time.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">552</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">553</span>: <span class="sd">        The semantics for missing data are identical to the ones described in</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">554</span>: <span class="sd">        the notes for :meth:`current`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">555</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">556</span>: <span class="sd">        Parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">557</span>: <span class="sd">        ----------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">558</span>: <span class="sd">        assets: zipline.assets.Asset or iterable of zipline.assets.Asset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">559</span>: <span class="sd">            The asset(s) for which data is requested.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">560</span>: <span class="sd">        fields: string or iterable of string.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">561</span>: <span class="sd">            Requested data field(s). Valid field names are: &quot;price&quot;,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">562</span>: <span class="sd">            &quot;last_traded&quot;, &quot;open&quot;, &quot;high&quot;, &quot;low&quot;, &quot;close&quot;, and &quot;volume&quot;.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">563</span>: <span class="sd">        bar_count: int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">564</span>: <span class="sd">            Number of data observations requested.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">565</span>: <span class="sd">        frequency: str</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">566</span>: <span class="sd">            String indicating whether to load daily or minutely data</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">567</span>: <span class="sd">            observations. Pass &#39;1m&#39; for minutely data, &#39;1d&#39; for daily data.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">568</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">569</span>: <span class="sd">        Returns</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">570</span>: <span class="sd">        -------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">571</span>: <span class="sd">        history : pd.Series or pd.DataFrame or pd.Panel</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">572</span>: <span class="sd">            See notes below.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">573</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">574</span>: <span class="sd">        Notes</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">575</span>: <span class="sd">        -----</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">576</span>: <span class="sd">        The return type of this function depends on the types of ``assets`` and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">577</span>: <span class="sd">        ``fields``:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">578</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">579</span>: <span class="sd">        - If a single asset and a single field are requested, the returned</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">580</span>: <span class="sd">          value is a :class:`pd.Series` of length ``bar_count`` whose index is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">581</span>: <span class="sd">          :class:`pd.DatetimeIndex`.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">582</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">583</span>: <span class="sd">        - If a single asset and multiple fields are requested, the returned</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">584</span>: <span class="sd">          value is a :class:`pd.DataFrame` with shape</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">585</span>: <span class="sd">          ``(bar_count, len(fields))``. The frame&#39;s index will be a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">586</span>: <span class="sd">          :class:`pd.DatetimeIndex`, and its columns will be ``fields``.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">587</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">588</span>: <span class="sd">        - If multiple assets and a single field are requested, the returned</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">589</span>: <span class="sd">          value is a :class:`pd.DataFrame` with shape</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">590</span>: <span class="sd">          ``(bar_count, len(assets))``. The frame&#39;s index will be a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">591</span>: <span class="sd">          :class:`pd.DatetimeIndex`, and its columns will be ``assets``.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">592</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">593</span>: <span class="sd">        - If multiple assets and multiple fields are requested, the returned</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">594</span>: <span class="sd">          value is a :class:`pd.DataFrame` with a pd.MultiIndex containing pairs of</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">595</span>: <span class="sd">           :class:`pd.DatetimeIndex`, and ``assets``, while the columns while contain the field(s).</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">596</span>: <span class="sd">           It has shape``(bar_count * len(assets), len(fields))``. The names of the pd.MultiIndex are</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">597</span>: <span class="sd">            - ``date`` if frequency == &#39;1d&#39;`` or ``date_time`` if frequency == &#39;1m``, and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">598</span>: <span class="sd">            - ``asset``</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">599</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">600</span>: <span class="sd">        If the current simulation time is not a valid market time, we use the last market close instead.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">601</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">602</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">603</span>:         <span class="n">single_field</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='py_c_api'>PyUnicode_Check</span>(__pyx_v_fields); 
  __pyx_v_single_field = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">604</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">605</span>:         <span class="n">single_asset</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">assets</span><span class="p">,</span> <span class="n">PricingDataAssociable</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_PricingDataAssociable);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 605, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_assets, __pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 605, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_single_asset = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">606</span>:         <span class="k">if</span> <span class="n">single_asset</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_single_asset != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">607</span>:             <span class="n">asset_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">assets</span><span class="p">]</span></pre>
<pre class='cython code score-7 '>    __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_assets);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_assets);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_assets);
    __pyx_v_asset_list = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">608</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">609</span>:             <span class="n">asset_list</span> <span class="o">=</span> <span class="n">assets</span></pre>
<pre class='cython code score-1 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_assets);
    __pyx_v_asset_list = __pyx_v_assets;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">610</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">611</span>:         <span class="k">if</span> <span class="n">single_field</span><span class="p">:</span>  <span class="c"># for one or more assets:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_single_field != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">612</span>:             <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_history_window</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_history_window);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
</pre><pre class="cython line score-0">&#xA0;<span class="">613</span>:                 <span class="n">asset_list</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">614</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-0">&#xA0;<span class="">615</span>:                 <span class="n">bar_count</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">616</span>:                 <span class="n">frequency</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">617</span>:                 <span class="n">fields</span><span class="p">,</span></pre>
<pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">618</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span><span class="p">,</span></pre>
<pre class='cython code score-46 '>    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_5)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
        __pyx_t_6 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
      PyObject *__pyx_temp[7] = {__pyx_t_5, __pyx_v_asset_list, __pyx_t_4, __pyx_v_bar_count, __pyx_v_frequency, __pyx_v_fields, __pyx_v_self-&gt;data_frequency};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 6+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
      PyObject *__pyx_temp[7] = {__pyx_t_5, __pyx_v_asset_list, __pyx_t_4, __pyx_v_bar_count, __pyx_v_frequency, __pyx_v_fields, __pyx_v_self-&gt;data_frequency};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 6+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    {
      __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(6+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      if (__pyx_t_5) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset_list);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset_list);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+__pyx_t_6, __pyx_v_asset_list);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1+__pyx_t_6, __pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_bar_count);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_bar_count);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 2+__pyx_t_6, __pyx_v_bar_count);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_frequency);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_frequency);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 3+__pyx_t_6, __pyx_v_frequency);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_fields);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_fields);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 4+__pyx_t_6, __pyx_v_fields);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 5+__pyx_t_6, __pyx_v_self-&gt;data_frequency);
      __pyx_t_4 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 612, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_df = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">619</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">620</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">621</span>:             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 621, __pyx_L1_error)</span>
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">622</span>:                 <span class="n">adjs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_adjustments</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_adjustments);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 622, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
</pre><pre class="cython line score-0">&#xA0;<span class="">623</span>:                     <span class="n">asset_list</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">624</span>:                     <span class="n">fields</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">625</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 625, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
</pre><pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">626</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">()</span></pre>
<pre class='cython code score-60 '>      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
      __pyx_t_5 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_8 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_8)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      __pyx_t_4 = (__pyx_t_8) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 626, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = NULL;
      __pyx_t_6 = 0;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
        __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
        if (likely(__pyx_t_5)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
          __pyx_t_6 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_asset_list, __pyx_v_fields, __pyx_t_7, __pyx_t_4};
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 622, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_asset_list, __pyx_v_fields, __pyx_t_7, __pyx_t_4};
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 622, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      } else
      #endif
      {
        __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 622, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        if (__pyx_t_5) {
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
        }
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset_list);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset_list);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_6, __pyx_v_asset_list);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_fields);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_fields);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_6, __pyx_v_fields);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2+__pyx_t_6, __pyx_t_7);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 3+__pyx_t_6, __pyx_t_4);
        __pyx_t_7 = 0;
        __pyx_t_4 = 0;
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 622, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_v_adjs = __pyx_t_2;
      __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">627</span>:                 <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">628</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">629</span>:                 <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">*</span> <span class="n">adjs</span></pre>
<pre class='cython code score-6 '>      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_df, __pyx_v_adjs);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 629, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_df, __pyx_t_2);
      __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">630</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">631</span>:             <span class="k">if</span> <span class="n">single_asset</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_single_asset != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">632</span>:                 <span class="c"># single asset, single field: return pd.Series with pd.DateTimeIndex</span></pre>
<pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">633</span>:                 <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">assets</span><span class="p">]</span></pre>
<pre class='cython code score-21 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_df, __pyx_n_s_loc);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 633, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 633, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__7);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__7);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_slice__7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_assets);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_assets);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_v_assets);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 633, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_r = __pyx_t_8;
      __pyx_t_8 = 0;
      goto __pyx_L0;
/* … */
  __pyx_slice__7 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__7)) __PYX_ERR(0, 633, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__7);
</pre><pre class="cython line score-0">&#xA0;<span class="">634</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">635</span>:                 <span class="c"># multiple assets, single field: return DataFrame with pd.DateTimeIndex</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">636</span>:                 <span class="c"># and assets in columns.</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">637</span>:                 <span class="k">return</span> <span class="n">df</span></pre>
<pre class='cython code score-2 '>    /*else*/ {
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_df);
      __pyx_r = __pyx_v_df;
      goto __pyx_L0;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">638</span>:         <span class="k">else</span><span class="p">:</span>  <span class="c"># multiple fields</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">639</span>:             <span class="c"># if single_asset:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">640</span>:             <span class="c"># todo: optimize by querying multiple fields</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">641</span>:             <span class="c"># Make multiple history calls, one per field, then combine results</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">642</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">643</span>:             <span class="n">df_dict</span> <span class="o">=</span> <span class="p">{</span></pre>
<pre class='cython code score-5 '>  /*else*/ {
    { /* enter inner scope */
      __pyx_t_8 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 643, __pyx_L9_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">644</span>:                 <span class="n">field</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_history_window</span><span class="p">(</span><span class="n">asset_list</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_history_window);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 644, __pyx_L9_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">645</span>:                                                            <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>        __pyx_t_7 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 645, __pyx_L9_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
</pre><pre class="cython line score-0">&#xA0;<span class="">646</span>:                                                            <span class="n">bar_count</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">647</span>:                                                            <span class="n">frequency</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">648</span>:                                                            <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">649</span>:                                                            <span class="bp">self</span><span class="o">.</span><span class="n">data_frequency</span><span class="p">,</span></pre>
<pre class='cython code score-46 '>        __pyx_t_5 = NULL;
        __pyx_t_6 = 0;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
          __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
          if (likely(__pyx_t_5)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
            __pyx_t_6 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
          PyObject *__pyx_temp[7] = {__pyx_t_5, __pyx_v_asset_list, __pyx_t_7, __pyx_v_bar_count, __pyx_v_frequency, __pyx_9genexpr10__pyx_v_field, __pyx_v_self-&gt;data_frequency};
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 6+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 644, __pyx_L9_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
          PyObject *__pyx_temp[7] = {__pyx_t_5, __pyx_v_asset_list, __pyx_t_7, __pyx_v_bar_count, __pyx_v_frequency, __pyx_9genexpr10__pyx_v_field, __pyx_v_self-&gt;data_frequency};
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 6+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 644, __pyx_L9_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        } else
        #endif
        {
          __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(6+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 644, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
          if (__pyx_t_5) {
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_5); __pyx_t_5 = NULL;
          }
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset_list);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset_list);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0+__pyx_t_6, __pyx_v_asset_list);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1+__pyx_t_6, __pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_bar_count);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_bar_count);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 2+__pyx_t_6, __pyx_v_bar_count);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_frequency);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_frequency);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 3+__pyx_t_6, __pyx_v_frequency);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_9genexpr10__pyx_v_field);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_9genexpr10__pyx_v_field);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 4+__pyx_t_6, __pyx_9genexpr10__pyx_v_field);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;data_frequency);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;data_frequency);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 5+__pyx_t_6, __pyx_v_self-&gt;data_frequency);
          __pyx_t_7 = 0;
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_11, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 644, __pyx_L9_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">650</span>:                                                            <span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">asset_list</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_loc);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 650, __pyx_L9_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 650, __pyx_L9_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__7);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__7);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_slice__7);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_asset_list);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_asset_list);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_v_asset_list);
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_t_4, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 650, __pyx_L9_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, (PyObject*)__pyx_9genexpr10__pyx_v_field, (PyObject*)__pyx_t_11))) <span class='error_goto'>__PYX_ERR(0, 644, __pyx_L9_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-45" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">651</span>:                 <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span></pre>
<pre class='cython code score-45 '>      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_fields)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_fields)) {
        __pyx_t_3 = __pyx_v_fields; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_9 = 0;
        __pyx_t_10 = NULL;
      } else {
        __pyx_t_9 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_fields);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 651, __pyx_L9_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_10 = Py_TYPE(__pyx_t_3)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 651, __pyx_L9_error)</span>
      }
      for (;;) {
        if (likely(!__pyx_t_10)) {
          if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3))) {
            if (__pyx_t_9 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 651, __pyx_L9_error)</span>
            #else
            __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 651, __pyx_L9_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            #endif
          } else {
            if (__pyx_t_9 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
            #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 651, __pyx_L9_error)</span>
            #else
            __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 651, __pyx_L9_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            #endif
          }
        } else {
          __pyx_t_2 = __pyx_t_10(__pyx_t_3);
          if (unlikely(!__pyx_t_2)) {
            PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
            if (exc_type) {
              if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
              else <span class='error_goto'>__PYX_ERR(0, 651, __pyx_L9_error)</span>
            }
            break;
          }
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        }
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_9genexpr10__pyx_v_field, __pyx_t_2);
        __pyx_t_2 = 0;
/* … */
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr10__pyx_v_field); __pyx_9genexpr10__pyx_v_field = 0;
      goto __pyx_L12_exit_scope;
      __pyx_L9_error:;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr10__pyx_v_field); __pyx_9genexpr10__pyx_v_field = 0;
      goto __pyx_L1_error;
      __pyx_L12_exit_scope:;
    } /* exit inner scope */
    __pyx_v_df_dict = ((PyObject*)__pyx_t_8);
    __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">652</span>:             <span class="p">}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">653</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">654</span>:             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 654, __pyx_L1_error)</span>
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">655</span>:                 <span class="n">adjs</span> <span class="o">=</span> <span class="p">{</span></pre>
<pre class='cython code score-5 '>      { /* enter inner scope */
        __pyx_t_8 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 655, __pyx_L16_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">656</span>:                     <span class="n">field</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_adjustments</span><span class="p">(</span></pre>
<pre class='cython code score-2 '>          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_adjustments);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 656, __pyx_L16_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
</pre><pre class="cython line score-0">&#xA0;<span class="">657</span>:                         <span class="n">assets</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">658</span>:                         <span class="n">field</span><span class="p">,</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">659</span>:                         <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_minute</span><span class="p">(),</span></pre>
<pre class='cython code score-0 '>          __pyx_t_4 = ((struct __pyx_vtabstruct_7zipline_9_protocol_BarData *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_current_minute(__pyx_v_self);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 659, __pyx_L16_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">660</span>:                         <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">()</span></pre>
<pre class='cython code score-60 '>          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
          __pyx_t_5 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_12 = NULL;
          if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
            __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
            if (likely(__pyx_t_12)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
            }
          }
          __pyx_t_7 = (__pyx_t_12) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_12) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
          if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 660, __pyx_L16_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          __pyx_t_5 = NULL;
          __pyx_t_6 = 0;
          if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
            __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
            if (likely(__pyx_t_5)) {
              PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
              <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
              <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
              __pyx_t_6 = 1;
            }
          }
          #if CYTHON_FAST_PYCALL
          if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_assets, __pyx_9genexpr11__pyx_v_field, __pyx_t_4, __pyx_t_7};
            __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 656, __pyx_L16_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          } else
          #endif
          #if CYTHON_FAST_PYCCALL
          if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
            PyObject *__pyx_temp[5] = {__pyx_t_5, __pyx_v_assets, __pyx_9genexpr11__pyx_v_field, __pyx_t_4, __pyx_t_7};
            __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 656, __pyx_L16_error)</span>
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          } else
          #endif
          {
            __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 656, __pyx_L16_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
            if (__pyx_t_5) {
              <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_5); __pyx_t_5 = NULL;
            }
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_assets);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_assets);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0+__pyx_t_6, __pyx_v_assets);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_9genexpr11__pyx_v_field);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_9genexpr11__pyx_v_field);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1+__pyx_t_6, __pyx_9genexpr11__pyx_v_field);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 2+__pyx_t_6, __pyx_t_4);
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
            <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 3+__pyx_t_6, __pyx_t_7);
            __pyx_t_4 = 0;
            __pyx_t_7 = 0;
            __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 656, __pyx_L16_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
          }
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-54" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">661</span>:                     <span class="p">)[</span><span class="mf">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span></pre>
<pre class='cython code score-54 '>        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_fields)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_fields)) {
          __pyx_t_3 = __pyx_v_fields; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_9 = 0;
          __pyx_t_10 = NULL;
        } else {
          __pyx_t_9 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_fields);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 661, __pyx_L16_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_10 = Py_TYPE(__pyx_t_3)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 661, __pyx_L16_error)</span>
        }
        for (;;) {
          if (likely(!__pyx_t_10)) {
            if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3))) {
              if (__pyx_t_9 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
              #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_11 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 661, __pyx_L16_error)</span>
              #else
              __pyx_t_11 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 661, __pyx_L16_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
              #endif
            } else {
              if (__pyx_t_9 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
              #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_11 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 661, __pyx_L16_error)</span>
              #else
              __pyx_t_11 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 661, __pyx_L16_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
              #endif
            }
          } else {
            __pyx_t_11 = __pyx_t_10(__pyx_t_3);
            if (unlikely(!__pyx_t_11)) {
              PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
              if (exc_type) {
                if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                else <span class='error_goto'>__PYX_ERR(0, 661, __pyx_L16_error)</span>
              }
              break;
            }
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
          }
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_9genexpr11__pyx_v_field, __pyx_t_11);
          __pyx_t_11 = 0;
/* … */
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_11, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 661, __pyx_L16_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
          if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, (PyObject*)__pyx_9genexpr11__pyx_v_field, (PyObject*)__pyx_t_2))) <span class='error_goto'>__PYX_ERR(0, 656, __pyx_L16_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr11__pyx_v_field); __pyx_9genexpr11__pyx_v_field = 0;
        goto __pyx_L19_exit_scope;
        __pyx_L16_error:;
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr11__pyx_v_field); __pyx_9genexpr11__pyx_v_field = 0;
        goto __pyx_L1_error;
        __pyx_L19_exit_scope:;
      } /* exit inner scope */
      __pyx_v_adjs = __pyx_t_8;
      __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">662</span>:                 <span class="p">}</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">663</span>: </pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">664</span>:                 <span class="n">df_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="n">df</span> <span class="o">*</span> <span class="n">adjs</span><span class="p">[</span><span class="n">field</span><span class="p">]</span></pre>
<pre class='cython code score-25 '>      { /* enter inner scope */
        __pyx_t_8 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 664, __pyx_L22_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
/* … */
          __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_adjs, __pyx_9genexpr12__pyx_v_field);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 664, __pyx_L22_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
          __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_9genexpr12__pyx_v_df, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 664, __pyx_L22_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
          if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, (PyObject*)__pyx_9genexpr12__pyx_v_field, (PyObject*)__pyx_t_2))) <span class='error_goto'>__PYX_ERR(0, 664, __pyx_L22_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr12__pyx_v_df); __pyx_9genexpr12__pyx_v_df = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr12__pyx_v_field); __pyx_9genexpr12__pyx_v_field = 0;
        goto __pyx_L25_exit_scope;
        __pyx_L22_error:;
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr12__pyx_v_df); __pyx_9genexpr12__pyx_v_df = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_9genexpr12__pyx_v_field); __pyx_9genexpr12__pyx_v_field = 0;
        goto __pyx_L1_error;
        __pyx_L25_exit_scope:;
      } /* exit inner scope */
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_df_dict, ((PyObject*)__pyx_t_8));
      __pyx_t_8 = 0;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">665</span>:                            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></pre>
<pre class='cython code score-3 '>        __pyx_t_9 = 0;
        __pyx_t_2 = __Pyx_dict_iterator(__pyx_v_df_dict, 1, __pyx_n_s_items, (&amp;__pyx_t_13), (&amp;__pyx_t_6));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 665, __pyx_L22_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
        __pyx_t_3 = __pyx_t_2;
        __pyx_t_2 = 0;
        while (1) {
          __pyx_t_14 = __Pyx_dict_iter_next(__pyx_t_3, __pyx_t_13, &amp;__pyx_t_9, &amp;__pyx_t_2, &amp;__pyx_t_11, NULL, __pyx_t_6);
          if (unlikely(__pyx_t_14 == 0)) break;
          if (unlikely(__pyx_t_14 == -1)) <span class='error_goto'>__PYX_ERR(0, 665, __pyx_L22_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_9genexpr12__pyx_v_field, __pyx_t_2);
          __pyx_t_2 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_9genexpr12__pyx_v_df, __pyx_t_11);
          __pyx_t_11 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">666</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">667</span>:             <span class="n">dt_label</span> <span class="o">=</span> <span class="s">&#39;date&#39;</span> <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s">&#39;1d&#39;</span> <span class="k">else</span> <span class="s">&#39;date_time&#39;</span></pre>
<pre class='cython code score-4 '>    __pyx_t_1 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_frequency, __pyx_kp_u_1d, Py_EQ)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 667, __pyx_L1_error)</span>
    if (__pyx_t_1) {
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_date);
      __pyx_t_8 = __pyx_n_u_date;
    } else {
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_date_time);
      __pyx_t_8 = __pyx_n_u_date_time;
    }
    __pyx_v_dt_label = ((PyObject*)__pyx_t_8);
    __pyx_t_8 = 0;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">668</span>:             <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_dict</span><span class="p">,</span></pre>
<pre class='cython code score-17 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_8, __pyx_n_s_pd);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_concat);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_df_dict);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_df_dict);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_df_dict);
/* … */
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_8, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 668, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">669</span>:                             <span class="n">keys</span><span class="o">=</span><span class="n">df_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span></pre>
<pre class='cython code score-10 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyDict_Keys</span>(__pyx_v_df_dict);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 669, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_keys, __pyx_t_11) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 669, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">670</span>:                             <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">,</span> <span class="n">dt_label</span><span class="p">])</span></pre>
<pre class='cython code score-15 '>    __pyx_t_11 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 670, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_fields);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_fields);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_11, 0, __pyx_n_u_fields);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dt_label);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dt_label);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_11, 1, __pyx_v_dt_label);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_names, __pyx_t_11) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 669, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">671</span>:                   <span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c"># ensure we return all fields/assets/dates despite missing values</span></pre>
<pre class='cython code score-14 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_stack);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 671, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 671, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_11, __pyx_n_s_dropna, Py_False) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 671, __pyx_L1_error)</span>
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 671, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">672</span>:                   <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s">&#39;fields&#39;</span><span class="p">))</span></pre>
<pre class='cython code score-14 '>    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_unstack);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, __pyx_n_s_level, __pyx_n_u_fields) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L1_error)</span>
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_11, __pyx_empty_tuple, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_v_df = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">673</span>:             <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_names</span><span class="p">([</span><span class="n">dt_label</span><span class="p">,</span> <span class="s">&#39;asset&#39;</span><span class="p">])</span></pre>
<pre class='cython code score-30 '>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_df, __pyx_n_s_index);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 673, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_8, __pyx_n_s_set_names);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 673, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 673, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dt_label);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dt_label);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_dt_label);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_asset);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_asset);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_8, 1, __pyx_n_u_asset);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_3, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 673, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">674</span>:             <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span></pre>
<pre class='cython code score-19 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_df, __pyx_n_s_sort_index);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 674, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_8 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
      __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
      if (likely(__pyx_t_8)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
      }
    }
    __pyx_t_2 = (__pyx_t_8) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 674, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">675</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">676</span>:     <span class="k">property</span> <span class="nf">current_dt</span><span class="p">:</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">677</span>:         <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_10current_dt_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_10current_dt_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_10current_dt___get__(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_10current_dt___get__(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__get__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__get__", __pyx_f[0], 677, 0, <span class='error_goto'>__PYX_ERR(0, 677, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.current_dt.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">678</span>:             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">()</span></pre>
<pre class='cython code score-18 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  __pyx_t_2 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 678, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">679</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">680</span>:     <span class="nd">@property</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">681</span>:     <span class="k">def</span> <span class="nf">fetcher_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre>
<pre class='cython code score-7 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_14fetcher_assets_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_14fetcher_assets_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_14fetcher_assets___get__(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_14fetcher_assets___get__(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__get__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__get__", __pyx_f[0], 681, 0, <span class='error_goto'>__PYX_ERR(0, 681, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.fetcher_assets.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">682</span>:         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_portal</span><span class="o">.</span><span class="n">get_fetcher_assets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">())</span></pre>
<pre class='cython code score-35 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;data_portal, __pyx_n_s_get_fetcher_assets);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 682, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  __pyx_t_4 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_5) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 682, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 682, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">683</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">684</span>:     <span class="k">property</span> <span class="nf">_handle_non_market_minutes</span><span class="p">:</span></pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">685</span>:         <span class="k">def</span> <span class="nf">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span></pre>
<pre class='cython code score-3 '>/* Python wrapper */
static int __pyx_pw_7zipline_9_protocol_7BarData_26_handle_non_market_minutes_1__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_val); /*proto*/
static int __pyx_pw_7zipline_9_protocol_7BarData_26_handle_non_market_minutes_1__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_val) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__set__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_26_handle_non_market_minutes___set__(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self), ((PyObject *)__pyx_v_val));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_7zipline_9_protocol_7BarData_26_handle_non_market_minutes___set__(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self, PyObject *__pyx_v_val) {
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__set__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__set__", __pyx_f[0], 685, 0, <span class='error_goto'>__PYX_ERR(0, 685, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData._handle_non_market_minutes.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">686</span>:             <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_minutes</span> <span class="o">=</span> <span class="n">val</span></pre>
<pre class='cython code score-4 '>  if (!(likely(((__pyx_v_val) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_val, __pyx_ptype_7cpython_4bool_bool))))) <span class='error_goto'>__PYX_ERR(0, 686, __pyx_L1_error)</span>
  __pyx_t_1 = __pyx_v_val;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;_adjust_minutes);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self-&gt;_adjust_minutes));
  __pyx_v_self-&gt;_adjust_minutes = ((PyBoolObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">687</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">688</span>:     <span class="k">property</span> <span class="nf">current_session</span><span class="p">:</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">689</span>:         <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre>
<pre class='cython code score-6 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_15current_session_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_15current_session_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_15current_session___get__(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_15current_session___get__(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__get__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__get__", __pyx_f[0], 689, 0, <span class='error_goto'>__PYX_ERR(0, 689, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.current_session.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">690</span>:             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trading_calendar</span><span class="o">.</span><span class="n">minute_to_session_label</span><span class="p">(</span></pre>
<pre class='cython code score-14 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;_trading_calendar, __pyx_n_s_minute_to_session_label);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
/* … */
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  __pyx_t_2 = 0;
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 690, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">691</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">simulation_dt_func</span><span class="p">(),</span></pre>
<pre class='cython code score-17 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;simulation_dt_func);
  __pyx_t_3 = __pyx_v_self-&gt;simulation_dt_func; __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 691, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">692</span>:                 <span class="n">direction</span><span class="o">=</span><span class="s">&quot;next&quot;</span></pre>
<pre class='cython code score-7 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 692, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_direction, __pyx_n_u_next) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 692, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">693</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">694</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">695</span>:     <span class="k">property</span> <span class="nf">current_session_minutes</span><span class="p">:</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">696</span>:         <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre>
<pre class='cython code score-6 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_23current_session_minutes_1__get__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7zipline_9_protocol_7BarData_23current_session_minutes_1__get__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__get__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_7BarData_23current_session_minutes___get__(((struct __pyx_obj_7zipline_9_protocol_BarData *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_7BarData_23current_session_minutes___get__(struct __pyx_obj_7zipline_9_protocol_BarData *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__get__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__get__", __pyx_f[0], 696, 0, <span class='error_goto'>__PYX_ERR(0, 696, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.BarData.current_session_minutes.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">697</span>:             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trading_calendar</span><span class="o">.</span><span class="n">minutes_for_session</span><span class="p">(</span></pre>
<pre class='cython code score-3 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_self-&gt;_trading_calendar, __pyx_n_s_minutes_for_session);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 697, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">698</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span></pre>
<pre class='cython code score-17 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_current_session);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 698, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 697, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">699</span>:             <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">700</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">701</span>: <span class="k">cdef</span> <span class="k">class</span> <span class="nf">InnerPosition</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">702</span>: <span class="w">    </span><span class="sd">&quot;&quot;&quot;The real values of a position.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">703</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">704</span>: <span class="sd">    This exists to be owned by both a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">705</span>: <span class="sd">    :class:`zipline.finance.position.Position` and a</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">706</span>: <span class="sd">    :class:`zipline.protocol.Position` at the same time without a cycle.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">707</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">708</span>:     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span></pre>
<pre class='cython code score-3 '>/* Python wrapper */
static int __pyx_pw_7zipline_9_protocol_13InnerPosition_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_7zipline_9_protocol_13InnerPosition_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_asset = 0;
  PyObject *__pyx_v_amount = 0;
  PyObject *__pyx_v_cost_basis = 0;
  PyObject *__pyx_v_last_sale_price = 0;
  PyObject *__pyx_v_last_sale_date = 0;
  PyObject *__pyx_v_last_open_price = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_asset,&amp;__pyx_n_s_amount,&amp;__pyx_n_s_cost_basis,&amp;__pyx_n_s_last_sale_price,&amp;__pyx_n_s_last_sale_date,&amp;__pyx_n_s_last_open_price,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[1] = ((PyObject *)__pyx_int_0);
    values[2] = ((PyObject *)__pyx_float_0_0);
    values[3] = ((PyObject *)__pyx_float_0_0);
/* … */
  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_7zipline_9_protocol_13InnerPosition___init__(struct __pyx_obj_7zipline_9_protocol_InnerPosition *__pyx_v_self, PyObject *__pyx_v_asset, PyObject *__pyx_v_amount, PyObject *__pyx_v_cost_basis, PyObject *__pyx_v_last_sale_price, PyObject *__pyx_v_last_sale_date, PyObject *__pyx_v_last_open_price) {
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 708, 0, <span class='error_goto'>__PYX_ERR(0, 708, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.InnerPosition.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">709</span>:                  <span class="n">asset</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">710</span>:                  <span class="n">amount</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">711</span>:                  <span class="n">cost_basis</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">712</span>:                  <span class="n">last_sale_price</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span></pre>
<pre class="cython line score-38" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">713</span>:                  <span class="n">last_sale_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span></pre>
<pre class='cython code score-38 '>    values[4] = ((PyObject *)Py_None);
    values[5] = ((PyObject *)__pyx_float_0_0);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_asset)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_amount);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cost_basis);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_last_sale_price);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_last_sale_date);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_last_open_price);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 708, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_asset = values[0];
    __pyx_v_amount = values[1];
    __pyx_v_cost_basis = values[2];
    __pyx_v_last_sale_price = values[3];
    __pyx_v_last_sale_date = values[4];
    __pyx_v_last_open_price = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 1, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 708, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.InnerPosition.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_7zipline_9_protocol_13InnerPosition___init__(((struct __pyx_obj_7zipline_9_protocol_InnerPosition *)__pyx_v_self), __pyx_v_asset, __pyx_v_amount, __pyx_v_cost_basis, __pyx_v_last_sale_price, __pyx_v_last_sale_date, __pyx_v_last_open_price);
</pre><pre class="cython line score-0">&#xA0;<span class="">714</span>:                  <span class="n">last_open_price</span><span class="o">=</span><span class="mf">0.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">715</span>:                  <span class="p">):</span></pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">716</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">asset</span> <span class="o">=</span> <span class="n">asset</span></pre>
<pre class='cython code score-4 '>  if (!(likely(((__pyx_v_asset) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_v_asset, __pyx_ptype_7zipline_6assets_7_assets_Asset))))) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
  __pyx_t_1 = __pyx_v_asset;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;asset);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_self-&gt;asset));
  __pyx_v_self-&gt;asset = ((struct __pyx_obj_7zipline_6assets_7_assets_Asset *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">717</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span></pre>
<pre class='cython code score-5 '>  __pyx_t_2 = __Pyx_PyInt_As_npy_int64(__pyx_v_amount); if (unlikely((__pyx_t_2 == ((npy_int64)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 717, __pyx_L1_error)</span>
  __pyx_v_self-&gt;amount = __pyx_t_2;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">718</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">cost_basis</span> <span class="o">=</span> <span class="n">cost_basis</span>  <span class="c"># per share</span></pre>
<pre class='cython code score-10 '>  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_cost_basis); if (unlikely((__pyx_t_3 == ((npy_float64)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 718, __pyx_L1_error)</span>
  __pyx_v_self-&gt;cost_basis = __pyx_t_3;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">719</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">last_sale_price</span> <span class="o">=</span> <span class="n">last_sale_price</span></pre>
<pre class='cython code score-10 '>  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_last_sale_price); if (unlikely((__pyx_t_3 == ((npy_float64)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 719, __pyx_L1_error)</span>
  __pyx_v_self-&gt;last_sale_price = __pyx_t_3;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">720</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">last_sale_date</span> <span class="o">=</span> <span class="n">last_sale_date</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_last_sale_date);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_last_sale_date);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;last_sale_date);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;last_sale_date);
  __pyx_v_self-&gt;last_sale_date = __pyx_v_last_sale_date;
</pre><pre class="cython line score-0">&#xA0;<span class="">721</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">722</span>:         <span class="c"># !346 #113 for current bar backtesting</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">723</span>:         <span class="c"># In order to calculate the initial value of stock.(`portfolio.start_portfolio_value`)</span></pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">724</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">last_open_price</span> <span class="o">=</span> <span class="n">last_open_price</span></pre>
<pre class='cython code score-10 '>  __pyx_t_3 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_v_last_open_price); if (unlikely((__pyx_t_3 == ((npy_float64)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 724, __pyx_L1_error)</span>
  __pyx_v_self-&gt;last_open_price = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">725</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">726</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">727</span>:     <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>/* Python wrapper */
static PyObject *__pyx_pw_7zipline_9_protocol_13InnerPosition_3__repr__(PyObject *__pyx_v_self); /*proto*/
static PyObject *__pyx_pw_7zipline_9_protocol_13InnerPosition_3__repr__(PyObject *__pyx_v_self) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__repr__ (wrapper)", 0);
  __pyx_r = __pyx_pf_7zipline_9_protocol_13InnerPosition_2__repr__(((struct __pyx_obj_7zipline_9_protocol_InnerPosition *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_7zipline_9_protocol_13InnerPosition_2__repr__(struct __pyx_obj_7zipline_9_protocol_InnerPosition *__pyx_v_self) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__repr__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__repr__", __pyx_f[0], 727, 0, <span class='error_goto'>__PYX_ERR(0, 727, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("zipline._protocol.InnerPosition.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">728</span>:         <span class="k">return</span> <span class="p">(</span></pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">729</span>:                 <span class="s">&#39;</span><span class="si">%s</span><span class="s">(asset=</span><span class="si">%r</span><span class="s">, amount=</span><span class="si">%r</span><span class="s">, cost_basis=</span><span class="si">%r</span><span class="s">,&#39;</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(14);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 729, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = 0;
  __pyx_t_3 = 127;
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyUnicode_Join</span>(__pyx_t_1, 14, __pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 729, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">730</span>:                 <span class="s">&#39; last_sale_price=</span><span class="si">%r</span><span class="s">, last_sale_date=</span><span class="si">%r</span><span class="s">, last_open_price=</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">731</span>:                     <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span></pre>
<pre class='cython code score-19 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))), __pyx_n_s_name);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Unicode</span>(__pyx_t_4), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_5) &gt; __pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_5) : __pyx_t_3;
  __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_asset_2);
  __pyx_t_2 += 7;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_asset_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_kp_u_asset_2);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">732</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">asset</span><span class="p">,</span></pre>
<pre class='cython code score-16 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Repr</span>(((PyObject *)__pyx_v_self-&gt;asset)), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 732, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_5) &gt; __pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_5) : __pyx_t_3;
  __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_5);
  __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_amount_2);
  __pyx_t_2 += 9;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_amount_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, __pyx_kp_u_amount_2);
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">733</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span></pre>
<pre class='cython code score-17 '>  __pyx_t_5 = __Pyx_PyInt_From_npy_int64(__pyx_v_self-&gt;amount);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 733, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Repr</span>(__pyx_t_5), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 733, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_4) &gt; __pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_4) : __pyx_t_3;
  __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, __pyx_t_4);
  __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_cost_basis_2);
  __pyx_t_2 += 13;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_cost_basis_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 5, __pyx_kp_u_cost_basis_2);
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">734</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">cost_basis</span><span class="p">,</span></pre>
<pre class='cython code score-22 '>  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_self-&gt;cost_basis);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 734, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Repr</span>(__pyx_t_4), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 734, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_5) &gt; __pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_5) : __pyx_t_3;
  __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 6, __pyx_t_5);
  __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_last_sale_price_2);
  __pyx_t_2 += 18;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_last_sale_price_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 7, __pyx_kp_u_last_sale_price_2);
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">735</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">last_sale_price</span><span class="p">,</span></pre>
<pre class='cython code score-22 '>  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_self-&gt;last_sale_price);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 735, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Repr</span>(__pyx_t_5), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 735, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_4) &gt; __pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_4) : __pyx_t_3;
  __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 8, __pyx_t_4);
  __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_last_sale_date_2);
  __pyx_t_2 += 17;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_last_sale_date_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 9, __pyx_kp_u_last_sale_date_2);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">736</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">last_sale_date</span><span class="p">,</span></pre>
<pre class='cython code score-16 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Repr</span>(__pyx_v_self-&gt;last_sale_date), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 736, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_4) &gt; __pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_4) : __pyx_t_3;
  __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 10, __pyx_t_4);
  __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_last_open_price_2);
  __pyx_t_2 += 18;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_last_open_price_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 11, __pyx_kp_u_last_open_price_2);
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">737</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">last_open_price</span><span class="p">,</span></pre>
<pre class='cython code score-22 '>  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_self-&gt;last_open_price);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 737, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Repr</span>(__pyx_t_4), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 737, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_5) &gt; __pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_5) : __pyx_t_3;
  __pyx_t_2 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 12, __pyx_t_5);
  __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u__8);
  __pyx_t_2 += 1;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u__8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 13, __pyx_kp_u__8);
</pre><pre class="cython line score-0">&#xA0;<span class="">738</span>:                 <span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">739</span>:         <span class="p">)</span></pre>
</div></body></html>
